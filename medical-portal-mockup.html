<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>åŒ»ç™‚ç­‰æƒ…å ±æ´»ç”¨åŸºç›¤ãƒãƒ¼ã‚¿ãƒ«</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Hiragino Sans', 'Yu Gothic', 'Meiryo', system-ui, sans-serif;
      min-height: 100vh;
      background: linear-gradient(145deg, #dce9ff 0%, #e4ebff 25%, #e8f5f0 55%, #fef3e8 100%);
      background-attachment: fixed;
    }

    /* â”€â”€ èƒŒæ™¯ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ–ãƒ­ãƒ– â”€â”€ */
    .blob {
      position: fixed; border-radius: 50%; pointer-events: none; z-index: 0;
      filter: blur(90px); opacity: 0; animation: blobIn 1.2s ease-out forwards;
    }
    .blob-1 { width: 560px; height: 560px; top: -120px; left: -140px; background: #3769AF; opacity: 0; animation-delay: 0.1s; }
    .blob-2 { width: 420px; height: 420px; top: -60px;  right: -100px; background: #F97316; opacity: 0; animation-delay: 0.25s; }
    .blob-3 { width: 480px; height: 480px; bottom: -80px; left: 38%;  background: #10B981; opacity: 0; animation-delay: 0.4s; }
    @keyframes blobIn { to { opacity: 0.09; } }

    #root { position: relative; z-index: 1; }

    /* â”€â”€ ã‚°ãƒ©ã‚¹ã‚«ãƒ¼ãƒ‰ â”€â”€ */
    .glass {
      background: rgba(255,255,255,0.68);
      backdrop-filter: blur(22px);
      -webkit-backdrop-filter: blur(22px);
      border: 1px solid rgba(255,255,255,0.82);
      box-shadow: 0 4px 32px rgba(26,54,93,0.07), 0 1px 4px rgba(0,0,0,0.04), inset 0 1px 0 rgba(255,255,255,0.95);
      border-radius: 16px;
    }
    .glass-dark {
      background: rgba(10,18,40,0.88);
      backdrop-filter: blur(28px);
      -webkit-backdrop-filter: blur(28px);
      border-bottom: 1px solid rgba(255,255,255,0.07);
    }
    .glass-blue {
      background: rgba(22,46,90,0.85);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-bottom: 1px solid rgba(255,255,255,0.09);
    }
    .glass-banner {
      background: linear-gradient(135deg, rgba(22,46,90,0.90) 0%, rgba(40,68,116,0.85) 100%);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 18px;
      box-shadow: 0 8px 40px rgba(26,54,93,0.22), 0 2px 8px rgba(0,0,0,0.10);
      position: relative; overflow: hidden;
    }
    .glass-banner::before {
      content: '';
      position: absolute; top: 0; left: 0; right: 0; height: 55%;
      background: linear-gradient(to bottom, rgba(255,255,255,0.05), transparent);
      pointer-events: none;
    }

    /* â”€â”€ ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ â”€â”€ */
    .btn-primary {
      background: linear-gradient(135deg, #F97316, #EA6C10);
      color: white; border: none; border-radius: 11px;
      font-weight: 700; cursor: pointer; font-family: inherit;
      box-shadow: 0 3px 12px rgba(249,115,22,0.40), inset 0 1px 0 rgba(255,255,255,0.18);
      transition: all 0.18s ease;
    }
    .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 6px 20px rgba(249,115,22,0.50), inset 0 1px 0 rgba(255,255,255,0.18); }
    .btn-outline {
      background: rgba(255,255,255,0.70); color: #1A365D;
      border: 1.5px solid rgba(26,54,93,0.25); border-radius: 11px;
      font-weight: 700; cursor: pointer; font-family: inherit;
      backdrop-filter: blur(8px); transition: all 0.18s ease;
    }
    .btn-outline:hover { background: rgba(255,255,255,0.90); border-color: #1A365D; transform: translateY(-1px); }
    .action-card {
      background: rgba(255,255,255,0.58); border: 1px solid rgba(255,255,255,0.80);
      border-radius: 14px; backdrop-filter: blur(12px);
      box-shadow: 0 2px 12px rgba(26,54,93,0.06); cursor: pointer;
      transition: all 0.20s ease; text-align: left;
    }
    .action-card:hover { background: rgba(255,255,255,0.82); transform: translateY(-2px); box-shadow: 0 6px 28px rgba(26,54,93,0.13); border-color: rgba(26,54,93,0.22); }
    .action-card-hot {
      background: linear-gradient(135deg, rgba(26,54,93,0.90), rgba(40,68,116,0.86));
      border: 1px solid rgba(255,255,255,0.14); border-radius: 14px;
      cursor: pointer; text-align: left; transition: all 0.20s ease;
      box-shadow: 0 4px 20px rgba(26,54,93,0.28), inset 0 1px 0 rgba(255,255,255,0.08);
    }
    .action-card-hot:hover { transform: translateY(-2px); box-shadow: 0 8px 32px rgba(26,54,93,0.38); }

    /* â”€â”€ ã‚¤ãƒ³ãƒ—ãƒƒãƒˆ â”€â”€ */
    .input-glass {
      background: rgba(255,255,255,0.70); backdrop-filter: blur(12px);
      border: 1.5px solid rgba(255,255,255,0.80);
      box-shadow: 0 1px 4px rgba(26,54,93,0.05), inset 0 1px 2px rgba(0,0,0,0.03);
      border-radius: 10px; outline: none; transition: all 0.18s ease;
    }
    .input-glass:focus { border-color: rgba(26,54,93,0.55); background: rgba(255,255,255,0.88); box-shadow: 0 0 0 3px rgba(26,54,93,0.10); }
    select.input-glass { cursor: pointer; }

    /* â”€â”€ ã‚¿ã‚°ãƒãƒƒãƒ— â”€â”€ */
    .chip-disease { background: rgba(55,105,175,0.12); color: #1A365D; border: 1px solid rgba(55,105,175,0.22); }
    .chip-drug    { background: rgba(249,115,22,0.10); color: #9A3412; border: 1px solid rgba(249,115,22,0.22); }

    /* â”€â”€ ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ â”€â”€ */
    ::-webkit-scrollbar { width: 5px; height: 5px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: rgba(26,54,93,0.20); border-radius: 10px; }

    /* â”€â”€ ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ â”€â”€ */
    @keyframes pulse   { 0%,100%{opacity:1} 50%{opacity:0.35} }
    @keyframes slideUp { from{opacity:0;transform:translateY(10px)} to{opacity:1;transform:translateY(0)} }
    @keyframes spin    { from{transform:rotate(0deg)} to{transform:rotate(360deg)} }
    @keyframes countUp { from{opacity:0.2;transform:scale(0.94)} to{opacity:1;transform:scale(1)} }
    @keyframes fadeIn  { from{opacity:0} to{opacity:1} }
    .slide-up   { animation: slideUp 0.28s cubic-bezier(0.22,1,0.36,1); }
    .fade-in    { animation: fadeIn  0.30s ease-out; }
    .pulse      { animation: pulse 2.2s infinite; }
    .spin       { animation: spin 1s linear infinite; }
    .count-anim { animation: countUp 0.38s cubic-bezier(0.22,1,0.36,1); }

    button { font-family: inherit; }
    input, select, textarea { font-family: inherit; }
    pre { font-family: 'Consolas', 'Monaco', monospace; }
  </style>
</head>
<body>
<!-- èƒŒæ™¯ãƒ–ãƒ­ãƒ– -->
<div class="blob blob-1"></div>
<div class="blob blob-2"></div>
<div class="blob blob-3"></div>

<div id="root"></div>
<script type="text/babel">
const { useState, useEffect, useRef, useMemo } = React;

const C = {
  primary: '#1A365D', primaryMid: '#2D4A7A', primaryLight: '#3769AF',
  accent: '#F97316', accentDark: '#EA6C10',
  success: '#059669', warning: '#D97706', danger: '#DC2626',
  text: '#0F1F3D', textMid: '#3D5280', textLight: '#8096B8',
  border: 'rgba(26,54,93,0.12)', borderLight: 'rgba(255,255,255,0.80)',
};

/* â”€â”€ ã‚°ãƒ©ã‚¹ã‚«ãƒ¼ãƒ‰ â”€â”€ */
const Card = ({ children, style, className = '' }) => (
  <div className={`glass ${className}`} style={{ padding: 20, ...style }}>
    {children}
  </div>
);

const SectionTitle = ({ children, sub }) => (
  <div style={{ marginBottom: 14 }}>
    <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>
      <div style={{ width: 3, height: 18, borderRadius: 2, background: `linear-gradient(to bottom, ${C.accent}, #FBBF24)`, flexShrink: 0 }} />
      <span style={{ fontSize: 13, fontWeight: 700, color: C.text, letterSpacing: '0.01em' }}>{children}</span>
    </div>
    {sub && <p style={{ fontSize: 11, color: C.textLight, marginTop: 3, marginLeft: 11 }}>{sub}</p>}
  </div>
);

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   næ•°è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function calcN(tags, logic, ageMin, ageMax, gender, yearStart, yearEnd) {
  const BASE = 500000;
  const lo = Math.min(ageMin, ageMax), hi = Math.max(ageMin, ageMax);
  const ageFactor    = Math.max(0.005, (hi - lo) / 100);
  const genderFactor = gender === 'all' ? 1.0 : 0.47;
  const yearFactor   = Math.max(1, parseInt(yearEnd) - parseInt(yearStart) + 1) / 6;
  let condFactor;
  if (tags.length === 0)        condFactor = 0.85;
  else if (logic === 'AND')     condFactor = Math.pow(0.60, tags.length);
  else                          condFactor = Math.min(0.90, 0.24 * tags.length + 0.06);
  return Math.max(0, Math.round(BASE * ageFactor * genderFactor * yearFactor * condFactor));
}

/* â”€â”€ ãƒ”ãƒ©ãƒŸãƒƒãƒ‰ãƒãƒ£ãƒ¼ãƒˆ â”€â”€ */
function PyramidChart({ ageMin = 0, ageMax = 100, gender = 'all' }) {
  const lo = Math.min(ageMin, ageMax), hi = Math.max(ageMin, ageMax);
  const ALL_ROWS = [
    { label:'80æ­³ä»¥ä¸Š', minA:80, maxA:100, mBase:38, fBase:62 },
    { label:'70-79æ­³',  minA:70, maxA:79,  mBase:72, fBase:85 },
    { label:'60-69æ­³',  minA:60, maxA:69,  mBase:90, fBase:82 },
    { label:'50-59æ­³',  minA:50, maxA:59,  mBase:78, fBase:70 },
    { label:'40-49æ­³',  minA:40, maxA:49,  mBase:58, fBase:52 },
    { label:'30-39æ­³',  minA:30, maxA:39,  mBase:32, fBase:28 },
    { label:'20-29æ­³',  minA:20, maxA:29,  mBase:18, fBase:15 },
  ];
  const rows = ALL_ROWS.map(r => ({
    ...r,
    active: r.maxA >= lo && r.minA <= hi,
    m: gender === 'female' ? 0 : r.mBase,
    f: gender === 'male'   ? 0 : r.fBase,
  }));
  const BW = 108, LW = 70, rh = 27, pad = 6;
  const totalW = BW * 2 + LW + 20;
  const totalH = rows.length * rh + 44;
  return (
    <svg viewBox={`0 0 ${totalW} ${totalH}`} width="100%">
      <defs>
        <linearGradient id="gradM" x1="1" y1="0" x2="0" y2="0">
          <stop offset="0%" stopColor="#3769AF" stopOpacity="0.9"/>
          <stop offset="100%" stopColor="#5B8DD9" stopOpacity="0.75"/>
        </linearGradient>
        <linearGradient id="gradF" x1="0" y1="0" x2="1" y2="0">
          <stop offset="0%" stopColor="#DB2777" stopOpacity="0.75"/>
          <stop offset="100%" stopColor="#EC4899" stopOpacity="0.9"/>
        </linearGradient>
      </defs>
      {gender !== 'female' && <text x={BW/2} y={14} textAnchor="middle" fontSize={9.5} fill="#3769AF" fontWeight="700" letterSpacing="0.5">ç”·æ€§ (%)</text>}
      <text x={BW+LW/2+10} y={14} textAnchor="middle" fontSize={9.5} fill={C.textMid} fontWeight="600">å¹´é½¢å±¤</text>
      {gender !== 'male'   && <text x={BW+LW+BW/2+20} y={14} textAnchor="middle" fontSize={9.5} fill="#DB2777" fontWeight="700" letterSpacing="0.5">å¥³æ€§ (%)</text>}
      {rows.map((r, i) => {
        const y = 20 + i * rh;
        const mW = (r.m / 100) * (BW - pad);
        const fW = (r.f / 100) * (BW - pad);
        const op = r.active ? 1 : 0.18;
        return (
          <g key={r.label}>
            {gender !== 'female' && <rect x={BW - mW - pad} y={y+3} width={mW} height={rh-6} fill="url(#gradM)" rx={4} opacity={op}/>}
            {gender !== 'male'   && <rect x={BW+LW+20+pad}  y={y+3} width={fW} height={rh-6} fill="url(#gradF)" rx={4} opacity={op}/>}
            <text x={BW+LW/2+10} y={y+16} textAnchor="middle" fontSize={8.5} fill={r.active ? C.text : C.textLight} fontWeight={r.active ? '600' : '400'}>{r.label}</text>
            {gender !== 'female' && r.m > 0 && r.active && <text x={BW-mW-pad-3} y={y+16} textAnchor="end" fontSize={7.5} fill={C.textLight}>{r.m}%</text>}
            {gender !== 'male'   && r.f > 0 && r.active && <text x={BW+LW+fW+26}   y={y+16} textAnchor="start" fontSize={7.5} fill={C.textLight}>{r.f}%</text>}
          </g>
        );
      })}
      <line x1={BW}       y1={18} x2={BW}       y2={totalH-6} stroke={C.border} strokeDasharray="2,2"/>
      <line x1={BW+LW+20} y1={18} x2={BW+LW+20} y2={totalH-6} stroke={C.border} strokeDasharray="2,2"/>
      {rows.some(r => !r.active) && (
        <text x={totalW/2} y={totalH} textAnchor="middle" fontSize={7.5} fill={C.accent} opacity={0.7}>â–² ç¶²æ›ã‘ = é¸æŠç¯„å›²å¤–</text>
      )}
    </svg>
  );
}

/* â”€â”€ ç¸¦æ£’ã‚°ãƒ©ãƒ• â”€â”€ */
function BarChart({ data, colorA = '#3769AF', colorB = '#5B8DD9', height = 100 }) {
  const id = `bg${Math.random().toString(36).slice(2,6)}`;
  const maxV = Math.max(...data.map(d => d.v), 1);
  const W = 300, H = height;
  const bw = (W - 20) / data.length - 5;
  return (
    <svg viewBox={`0 0 ${W} ${H + 30}`} width="100%">
      <defs>
        <linearGradient id={id} x1="0" y1="0" x2="0" y2="1">
          <stop offset="0%" stopColor={colorA} stopOpacity="0.92"/>
          <stop offset="100%" stopColor={colorB} stopOpacity="0.65"/>
        </linearGradient>
      </defs>
      {data.map((d, i) => {
        const bh = Math.max(2, (d.v / maxV) * H);
        const x  = 10 + i * ((W - 20) / data.length);
        const y  = H - bh;
        const lbl = d.v >= 10000 ? `${(d.v/10000).toFixed(1)}ä¸‡` : d.v >= 1000 ? `${(d.v/1000).toFixed(1)}k` : String(d.v);
        return (
          <g key={d.l}>
            <rect x={x} y={y} width={bw} height={bh} fill={`url(#${id})`} rx={4}/>
            <text x={x+bw/2} y={y-4} textAnchor="middle" fontSize={7.5} fill={C.textMid} fontWeight="600">{lbl}</text>
            <text x={x+bw/2} y={H+14} textAnchor="middle" fontSize={8} fill={C.textLight}>{d.l}</text>
          </g>
        );
      })}
      <line x1={8} y1={H} x2={W} y2={H} stroke={C.border}/>
    </svg>
  );
}

/* â”€â”€ æŠ˜ã‚Œç·šã‚°ãƒ©ãƒ• â”€â”€ */
function LineChart({ data }) {
  if (!data || data.length < 2) return (
    <div style={{ textAlign:'center', padding:'20px 0', color:C.textLight, fontSize:12 }}>æœŸé–“ã‚’2å¹´ä»¥ä¸Šé¸æŠã—ã¦ãã ã•ã„</div>
  );
  const W = 320, H = 72, px = 16, py = 10;
  const vals = data.map(d => d.v);
  const mn = Math.min(...vals), mx = Math.max(...vals), rng = mx - mn || 1;
  const pts = data.map((d, i) => [
    px + (i / (data.length - 1)) * (W - px * 2),
    py + (1 - (d.v - mn) / rng) * (H - py * 2),
  ]);
  const line = `M${pts.map(p => p.join(',')).join(' L')}`;
  const area = `M${pts[0]} L${pts.map(p => p.join(',')).join(' L')} L${pts[pts.length-1][0]},${H-py} L${pts[0][0]},${H-py} Z`;
  return (
    <svg viewBox={`0 0 ${W} ${H + 20}`} width="100%">
      <defs>
        <linearGradient id="lineGrad" x1="0" y1="0" x2="0" y2="1">
          <stop offset="0%"   stopColor="#3769AF" stopOpacity="0.20"/>
          <stop offset="100%" stopColor="#3769AF" stopOpacity="0.01"/>
        </linearGradient>
      </defs>
      <path d={area} fill="url(#lineGrad)"/>
      <path d={line} stroke="#3769AF" strokeWidth="2.5" fill="none" strokeLinecap="round" strokeLinejoin="round"/>
      {pts.map((p, i) => (
        <g key={i}>
          <circle cx={p[0]} cy={p[1]} r={4} fill="white" stroke="#3769AF" strokeWidth="2"/>
          <text x={p[0]} y={H+15} textAnchor="middle" fontSize={8.5} fill={C.textLight}>{data[i].l}</text>
          <text x={p[0]} y={p[1]-9} textAnchor="middle" fontSize={8} fill={C.textMid} fontWeight="600">
            {data[i].v >= 1000 ? `${(data[i].v/1000).toFixed(1)}k` : data[i].v}
          </text>
        </g>
      ))}
    </svg>
  );
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ç”»é¢: é¡ä¼¼ç ”ç©¶æ¤œç´¢
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function ResearchSearchScreen({ setTab }) {
  const [keyword, setKeyword] = React.useState('');
  const [filterYear, setFilterYear] = React.useState('all');
  const [filterDesign, setFilterDesign] = React.useState('all');
  const [filterData, setFilterData] = React.useState('all');
  const [selected, setSelected] = React.useState(null);

  const projectConditions = {
    diseases: ['2å‹ç³–å°¿ç—… (E11)', 'é«˜è¡€åœ§ (I10)'],
    drugs: ['ãƒ¡ãƒˆãƒ›ãƒ«ãƒŸãƒ³'],
    ageRange: '60ã€œ85æ­³',
    period: '2019ã€œ2023å¹´',
    dataSources: ['NDB', 'DPC', 'ãƒ¬ã‚»ãƒ—ãƒˆ'],
  };

  const ALL_PAPERS = [
    {
      id:1,
      title:'é«˜é½¢2å‹ç³–å°¿ç—…æ‚£è€…ã«ãŠã‘ã‚‹å¿ƒè¡€ç®¡ã‚¤ãƒ™ãƒ³ãƒˆã¨ãƒ¡ãƒˆãƒ›ãƒ«ãƒŸãƒ³ä½¿ç”¨ã®é–¢é€£ï¼šNDBã‚’ç”¨ã„ãŸå¤§è¦æ¨¡ã‚³ãƒ›ãƒ¼ãƒˆç ”ç©¶',
      authors:'å±±ç”° å¥å¤ª, å°æ— ç¥å­, æ¸¡è¾º èª  ä»–',
      journal:'ç³–å°¿ç—…',
      year:2023,
      design:'ã‚³ãƒ›ãƒ¼ãƒˆç ”ç©¶',
      diseases:['2å‹ç³–å°¿ç—…','é«˜è¡€åœ§'],
      drugs:['ãƒ¡ãƒˆãƒ›ãƒ«ãƒŸãƒ³'],
      ageRange:'65ã€œ85æ­³',
      n:18432,
      dataSources:['NDB'],
      score:96,
      abstract:'NDBã‚’ç”¨ã„ã¦é«˜é½¢2å‹ç³–å°¿ç—…æ‚£è€…18,432ä¾‹ã‚’å¯¾è±¡ã«ã€ãƒ¡ãƒˆãƒ›ãƒ«ãƒŸãƒ³ä½¿ç”¨ã¨å¿ƒè¡€ç®¡ã‚¤ãƒ™ãƒ³ãƒˆç™ºç—‡ã®é–¢é€£ã‚’å¾Œã‚å‘ãã‚³ãƒ›ãƒ¼ãƒˆç ”ç©¶ã§æ¤œè¨ã—ãŸã€‚ãƒ¡ãƒˆãƒ›ãƒ«ãƒŸãƒ³ç¾¤ã§ã¯éä½¿ç”¨ç¾¤ã¨æ¯”è¼ƒã—ã¦ä¸»è¦å¿ƒè¡€ç®¡ã‚¤ãƒ™ãƒ³ãƒˆãŒæœ‰æ„ã«å°‘ãªãï¼ˆHR 0.78, 95%CI 0.71â€“0.86ï¼‰ã€ç‰¹ã«65ã€œ75æ­³å±¤ã§ã®åŠ¹æœãŒé¡•è‘—ã§ã‚ã£ãŸã€‚',
      matchPoints:['2å‹ç³–å°¿ç—…','é«˜è¡€åœ§','ãƒ¡ãƒˆãƒ›ãƒ«ãƒŸãƒ³','é«˜é½¢è€…ï¼ˆ65æ­³ä»¥ä¸Šï¼‰','NDB'],
    },
    {
      id:2,
      title:'å¾ŒæœŸé«˜é½¢è€…ã«ãŠã‘ã‚‹è¡€ç³–ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã¨ãƒ•ãƒ¬ã‚¤ãƒ«ç™ºç—‡ã®ç¸¦æ–­çš„æ¤œè¨ï¼šãƒ¬ã‚»ãƒ—ãƒˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è§£æ',
      authors:'éˆ´æœ¨ ç¾å’², é«˜æ©‹ ä¸€éƒ, ä¼Šè—¤ æµå­ ä»–',
      journal:'æ—¥æœ¬è€å¹´åŒ»å­¦ä¼šé›‘èªŒ',
      year:2022,
      design:'å¾Œã‚å‘ãã‚³ãƒ›ãƒ¼ãƒˆ',
      diseases:['2å‹ç³–å°¿ç—…','ãƒ•ãƒ¬ã‚¤ãƒ«'],
      drugs:['ãƒ¡ãƒˆãƒ›ãƒ«ãƒŸãƒ³','DPP-4é˜»å®³è–¬'],
      ageRange:'75ã€œ90æ­³',
      n:9847,
      dataSources:['ãƒ¬ã‚»ãƒ—ãƒˆ'],
      score:88,
      abstract:'å¾ŒæœŸé«˜é½¢è€…9,847ä¾‹ã‚’å¯¾è±¡ã«ã€HbA1cå€¤ã¨ãƒ•ãƒ¬ã‚¤ãƒ«ç™ºç—‡ã®é–¢ä¿‚ã‚’ãƒ¬ã‚»ãƒ—ãƒˆãƒ‡ãƒ¼ã‚¿ã§è§£æã€‚HbA1c 7.0â€“7.9%ç¾¤ã§ãƒ•ãƒ¬ã‚¤ãƒ«ç™ºç—‡ç‡ãŒæœ€ã‚‚ä½ãã€éåº¦ãªè¡€ç³–ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ï¼ˆ<7.0%ï¼‰ã¯ãƒ•ãƒ¬ã‚¤ãƒ«ãƒªã‚¹ã‚¯ã‚’å¢—åŠ ã•ã›ã‚‹ã“ã¨ãŒç¤ºã•ã‚ŒãŸã€‚',
      matchPoints:['2å‹ç³–å°¿ç—…','ãƒ¡ãƒˆãƒ›ãƒ«ãƒŸãƒ³','é«˜é½¢è€…ï¼ˆ75æ­³ä»¥ä¸Šï¼‰','ãƒ¬ã‚»ãƒ—ãƒˆ'],
    },
    {
      id:3,
      title:'2å‹ç³–å°¿ç—…åˆä½µé«˜è¡€åœ§æ‚£è€…ã®å¿ƒè…ã‚¢ã‚¦ãƒˆã‚«ãƒ ã«é–¢ã™ã‚‹ãƒªã‚¢ãƒ«ãƒ¯ãƒ¼ãƒ«ãƒ‰ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹ï¼šDPCãƒ‡ãƒ¼ã‚¿è§£æ',
      authors:'ä¸­æ‘ èª ä¸€, å²¡ç”° æµ©ä¹‹, æ¾æœ¬ çœŸç† ä»–',
      journal:'é«˜è¡€åœ§ç ”ç©¶',
      year:2023,
      design:'è¦³å¯Ÿç ”ç©¶ï¼ˆRWEï¼‰',
      diseases:['2å‹ç³–å°¿ç—…','é«˜è¡€åœ§','CKD'],
      drugs:['ãƒ¡ãƒˆãƒ›ãƒ«ãƒŸãƒ³','ARB'],
      ageRange:'60ã€œ80æ­³',
      n:24561,
      dataSources:['DPC'],
      score:83,
      abstract:'DPCãƒ‡ãƒ¼ã‚¿ã‚’ç”¨ã„ã¦2å‹ç³–å°¿ç—…åˆä½µé«˜è¡€åœ§æ‚£è€…24,561ä¾‹ã‚’è§£æã€‚SGLT2é˜»å®³è–¬ã¨ARBä½µç”¨ç¾¤ã§å¿ƒè…è¤‡åˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®æœ‰æ„ãªä½ä¸‹ã‚’ç¢ºèªï¼ˆHR 0.71, p<0.001ï¼‰ã€‚60ã€œ70æ­³ã®æ¯”è¼ƒçš„è‹¥ã„é«˜é½¢è€…å±¤ã§ã®å¿ƒè…ä¿è­·åŠ¹æœãŒæ˜ã‚‰ã‹ã«ãªã£ãŸã€‚',
      matchPoints:['2å‹ç³–å°¿ç—…','é«˜è¡€åœ§','ãƒ¡ãƒˆãƒ›ãƒ«ãƒŸãƒ³','DPC'],
    },
    {
      id:4,
      title:'é«˜é½¢ç³–å°¿ç—…æ‚£è€…ã«ãŠã‘ã‚‹èªçŸ¥æ©Ÿèƒ½ä½ä¸‹ãƒªã‚¹ã‚¯ã¨è–¬ç‰©ç™‚æ³•ã®é–¢é€£ï¼šå¤šæ–½è¨­å¾Œã‚å‘ãã‚³ãƒ›ãƒ¼ãƒˆç ”ç©¶',
      authors:'ç”°ä¸­ å“²æœ—, ä½è—¤ ç”±ç¾, æœ¨æ‘ æ­£ ä»–',
      journal:'Geriatrics & Gerontology International',
      year:2022,
      design:'å¤šæ–½è¨­ã‚³ãƒ›ãƒ¼ãƒˆ',
      diseases:['2å‹ç³–å°¿ç—…','èªçŸ¥æ©Ÿèƒ½ä½ä¸‹'],
      drugs:['ãƒ¡ãƒˆãƒ›ãƒ«ãƒŸãƒ³','ã‚¤ãƒ³ã‚¹ãƒªãƒ³'],
      ageRange:'70ã€œ85æ­³',
      n:6234,
      dataSources:['é›»å­ã‚«ãƒ«ãƒ†(è©¦)'],
      score:79,
      abstract:'å¤šæ–½è¨­ã®é›»å­ã‚«ãƒ«ãƒ†ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰é«˜é½¢ç³–å°¿ç—…æ‚£è€…6,234ä¾‹ã‚’æŠ½å‡ºã—ã€èªçŸ¥æ©Ÿèƒ½ä½ä¸‹ã¨ã®é–¢é€£ã‚’æ¤œè¨ã€‚ãƒ¡ãƒˆãƒ›ãƒ«ãƒŸãƒ³é•·æœŸä½¿ç”¨ï¼ˆ5å¹´ä»¥ä¸Šï¼‰ã¯èªçŸ¥ç—‡ç™ºç—‡ãƒªã‚¹ã‚¯ã®ä½ä¸‹ã¨æœ‰æ„ã«é–¢é€£ã—ï¼ˆOR 0.68, 95%CI 0.56â€“0.82ï¼‰ã€æ—©æœŸä»‹å…¥ã®é‡è¦æ€§ãŒç¤ºå”†ã•ã‚ŒãŸã€‚',
      matchPoints:['2å‹ç³–å°¿ç—…','ãƒ¡ãƒˆãƒ›ãƒ«ãƒŸãƒ³','é«˜é½¢è€…','é›»å­ã‚«ãƒ«ãƒ†'],
    },
    {
      id:5,
      title:'çµŒå£è¡€ç³–é™ä¸‹è–¬ã®ç¨®é¡åˆ¥å¿ƒè¡€ç®¡ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ã‚¯æ¯”è¼ƒï¼šå…¨å›½ãƒ¬ã‚»ãƒ—ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ç”¨ã„ãŸå¤§è¦æ¨¡è¦³å¯Ÿç ”ç©¶',
      authors:'è—¤äº• æµ©, è¥¿ç”° æ˜å­, å‰ç”° éš†å¸ ä»–',
      journal:'Journal of Diabetes Investigation',
      year:2021,
      design:'å¾Œã‚å‘ãã‚³ãƒ›ãƒ¼ãƒˆ',
      diseases:['2å‹ç³–å°¿ç—…'],
      drugs:['ãƒ¡ãƒˆãƒ›ãƒ«ãƒŸãƒ³','SGLT2é˜»å®³è–¬','DPP-4é˜»å®³è–¬'],
      ageRange:'60ã€œ89æ­³',
      n:52891,
      dataSources:['NDB','ãƒ¬ã‚»ãƒ—ãƒˆ'],
      score:75,
      abstract:'å…¨å›½ãƒ¬ã‚»ãƒ—ãƒˆãƒ‡ãƒ¼ã‚¿52,891ä¾‹ã‚’å¯¾è±¡ã«ã€ä¸»è¦çµŒå£è¡€ç³–é™ä¸‹è–¬åˆ¥ã®å¿ƒè¡€ç®¡ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ã‚¯ã‚’IPWæ³•ã§æ¯”è¼ƒã€‚SGLT2é˜»å®³è–¬ç¾¤ã§MACEãƒªã‚¹ã‚¯ãŒæœ€ã‚‚ä½ãï¼ˆHR 0.74ï¼‰ã€60ã€œ70æ­³ã®CKDåˆä½µä¾‹ã§ã®æœ‰ç›Šæ€§ãŒç‰¹ã«é¡•è‘—ã§ã‚ã£ãŸã€‚',
      matchPoints:['2å‹ç³–å°¿ç—…','ãƒ¡ãƒˆãƒ›ãƒ«ãƒŸãƒ³','é«˜é½¢è€…','NDB','ãƒ¬ã‚»ãƒ—ãƒˆ'],
    },
  ];

  const filtered = ALL_PAPERS.filter(p => {
    if (keyword) {
      const kw = keyword.toLowerCase();
      const hit = p.title.includes(keyword) || p.authors.includes(keyword)
        || p.diseases.some(d => d.includes(keyword)) || p.drugs.some(d => d.includes(keyword))
        || p.journal.toLowerCase().includes(kw);
      if (!hit) return false;
    }
    if (filterYear !== 'all' && p.year !== parseInt(filterYear)) return false;
    if (filterDesign !== 'all' && !p.design.includes(filterDesign)) return false;
    if (filterData !== 'all' && !p.dataSources.includes(filterData)) return false;
    return true;
  });

  const scoreColor = s => s >= 90 ? '#059669' : s >= 80 ? '#3769AF' : s >= 70 ? '#F97316' : '#8096B8';

  return (
    <div className="slide-up">
      {/* ãƒãƒŠãƒ¼ */}
      <div className="glass-banner" style={{ padding:'20px 28px', marginBottom:18, color:'white', display:'flex', alignItems:'center', justifyContent:'space-between' }}>
        <div style={{ position:'absolute', right:0, top:0, bottom:0, width:260, background:'radial-gradient(ellipse at 60% 50%, rgba(55,105,175,0.28) 0%, transparent 72%)', pointerEvents:'none' }}/>
        <div style={{ position:'relative' }}>
          <div style={{ fontSize:11, color:'rgba(147,197,253,0.85)', marginBottom:4, letterSpacing:'0.06em', textTransform:'uppercase' }}>ã‚­ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ¸ˆã¿ç ”ç©¶ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ â€” 2,847ä»¶</div>
          <h2 style={{ fontSize:20, fontWeight:700, letterSpacing:'-0.02em', marginBottom:4 }}>ğŸ” é¡ä¼¼ç ”ç©¶æ¤œç´¢</h2>
          <p style={{ fontSize:12, color:'rgba(191,219,254,0.80)' }}>ç¾åœ¨ã®ç ”ç©¶æ¡ä»¶ï¼ˆé«˜é½¢è€…ç³–å°¿ç—…ã‚³ãƒ›ãƒ¼ãƒˆï¼‰ã‹ã‚‰è‡ªå‹•æŠ½å‡ºã—ãŸæ¡ä»¶ã§ãƒãƒƒãƒãƒ³ã‚°</p>
        </div>
        <div style={{ position:'relative', display:'flex', gap:12, alignItems:'center' }}>
          <div style={{ background:'rgba(255,255,255,0.10)', border:'1px solid rgba(255,255,255,0.16)', borderRadius:12, padding:'10px 22px', textAlign:'center', backdropFilter:'blur(8px)' }}>
            <div style={{ fontSize:28, fontWeight:800, lineHeight:1 }}>{filtered.length}</div>
            <div style={{ fontSize:10, color:'rgba(191,219,254,0.80)', marginTop:2 }}>ä»¶ãƒ’ãƒƒãƒˆ</div>
          </div>
          <div style={{ background:'rgba(255,255,255,0.07)', border:'1px solid rgba(255,255,255,0.12)', borderRadius:12, padding:'10px 22px', textAlign:'center', backdropFilter:'blur(8px)' }}>
            <div style={{ fontSize:28, fontWeight:800, lineHeight:1 }}>2,847</div>
            <div style={{ fontSize:10, color:'rgba(191,219,254,0.80)', marginTop:2 }}>ä»¶ç·æ•°</div>
          </div>
        </div>
      </div>

      <div style={{ display:'grid', gridTemplateColumns:'290px 1fr', gap:18 }}>
        {/* å·¦: æ¡ä»¶ãƒ‘ãƒãƒ« */}
        <div style={{ display:'flex', flexDirection:'column', gap:14 }}>
          <Card style={{ padding:18 }}>
            <SectionTitle sub="ç¾åœ¨ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¡ä»¶ã‹ã‚‰è‡ªå‹•å¼•ãç¶™ã">æ¤œç´¢æ¡ä»¶</SectionTitle>
            <div style={{ display:'flex', flexDirection:'column', gap:12 }}>
              <div>
                <div style={{ fontSize:9.5, color:C.textLight, marginBottom:5, fontWeight:700, letterSpacing:'0.06em', textTransform:'uppercase' }}>å¯¾è±¡ç–¾æ‚£</div>
                <div style={{ display:'flex', flexWrap:'wrap', gap:5 }}>
                  {projectConditions.diseases.map(d => <span key={d} className="chip-disease" style={{ padding:'3px 10px', borderRadius:999, fontSize:11, fontWeight:600 }}>{d}</span>)}
                </div>
              </div>
              <div>
                <div style={{ fontSize:9.5, color:C.textLight, marginBottom:5, fontWeight:700, letterSpacing:'0.06em', textTransform:'uppercase' }}>è–¬å‰¤</div>
                <div style={{ display:'flex', flexWrap:'wrap', gap:5 }}>
                  {projectConditions.drugs.map(d => <span key={d} className="chip-drug" style={{ padding:'3px 10px', borderRadius:999, fontSize:11, fontWeight:600 }}>{d}</span>)}
                </div>
              </div>
              <div style={{ display:'grid', gridTemplateColumns:'1fr 1fr', gap:7 }}>
                {[['å¹´é½¢ç¯„å›²', projectConditions.ageRange],['è¦³å¯ŸæœŸé–“', projectConditions.period]].map(([l,v]) => (
                  <div key={l} style={{ background:'rgba(26,54,93,0.06)', borderRadius:9, padding:'8px 10px', border:'1px solid rgba(26,54,93,0.08)' }}>
                    <div style={{ fontSize:9.5, color:C.textLight, marginBottom:2 }}>{l}</div>
                    <div style={{ fontSize:11.5, fontWeight:700, color:C.text }}>{v}</div>
                  </div>
                ))}
              </div>
              <div>
                <div style={{ fontSize:9.5, color:C.textLight, marginBottom:5, fontWeight:700, letterSpacing:'0.06em', textTransform:'uppercase' }}>ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹</div>
                <div style={{ display:'flex', flexWrap:'wrap', gap:5 }}>
                  {projectConditions.dataSources.map(d => <span key={d} style={{ padding:'3px 10px', borderRadius:999, fontSize:11, fontWeight:600, background:'rgba(55,105,175,0.09)', color:C.primaryLight, border:'1px solid rgba(55,105,175,0.18)' }}>{d}</span>)}
                </div>
              </div>
            </div>
            <div style={{ marginTop:14, padding:'9px 12px', background:'rgba(249,115,22,0.07)', border:'1px solid rgba(249,115,22,0.20)', borderRadius:9, fontSize:11, color:'#9A3412', display:'flex', gap:6, alignItems:'center' }}>
              <span>âš¡</span><span>æ¡ä»¶ã¯ã‚³ãƒ›ãƒ¼ãƒˆç”»é¢ã¨é€£å‹•ã—ã¦ã„ã¾ã™</span>
            </div>
          </Card>

          <Card style={{ padding:18 }}>
            <SectionTitle>ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢</SectionTitle>
            <input className="input-glass" value={keyword} onChange={e => setKeyword(e.target.value)}
              placeholder="ç–¾æ‚£åãƒ»è–¬å‰¤ãƒ»è‘—è€…å..."
              style={{ width:'100%', padding:'9px 12px', fontSize:12 }} />
          </Card>

          <Card style={{ padding:18 }}>
            <SectionTitle>çµã‚Šè¾¼ã¿</SectionTitle>
            <div style={{ display:'flex', flexDirection:'column', gap:10 }}>
              {[
                ['æ²è¼‰å¹´', filterYear, setFilterYear, [['all','ã™ã¹ã¦'],[2023,'2023å¹´'],[2022,'2022å¹´'],[2021,'2021å¹´'],[2020,'2020å¹´']]],
                ['ç ”ç©¶ãƒ‡ã‚¶ã‚¤ãƒ³', filterDesign, setFilterDesign, [['all','ã™ã¹ã¦'],['ã‚³ãƒ›ãƒ¼ãƒˆ','ã‚³ãƒ›ãƒ¼ãƒˆç ”ç©¶'],['è¦³å¯Ÿç ”ç©¶','è¦³å¯Ÿç ”ç©¶'],['å¤šæ–½è¨­','å¤šæ–½è¨­ç ”ç©¶']]],
                ['ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹', filterData, setFilterData, [['all','ã™ã¹ã¦'],['NDB','NDB'],['DPC','DPC'],['ãƒ¬ã‚»ãƒ—ãƒˆ','ãƒ¬ã‚»ãƒ—ãƒˆ'],['é›»å­ã‚«ãƒ«ãƒ†(è©¦)','é›»å­ã‚«ãƒ«ãƒ†']]],
              ].map(([label, val, setter, opts]) => (
                <div key={label}>
                  <div style={{ fontSize:11, color:C.textLight, marginBottom:5, fontWeight:600 }}>{label}</div>
                  <select className="input-glass" value={val} onChange={e => setter(e.target.value)} style={{ width:'100%', padding:'8px 10px', fontSize:12 }}>
                    {opts.map(([v,l]) => <option key={v} value={v}>{l}</option>)}
                  </select>
                </div>
              ))}
            </div>
          </Card>
        </div>

        {/* å³: æ¤œç´¢çµæœ */}
        <div style={{ display:'flex', flexDirection:'column', gap:12 }}>
          {filtered.length === 0 ? (
            <Card style={{ padding:48, textAlign:'center' }}>
              <div style={{ fontSize:40, marginBottom:12 }}>ğŸ”</div>
              <div style={{ color:C.textLight, fontSize:14 }}>è©²å½“ã™ã‚‹ç ”ç©¶ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ</div>
              <div style={{ color:C.textLight, fontSize:12, marginTop:6 }}>ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å¤‰ãˆã¦å†æ¤œç´¢ã—ã¦ãã ã•ã„</div>
            </Card>
          ) : filtered.map(p => {
            const isSel = selected === p.id;
            const sc = scoreColor(p.score);
            return (
              <div key={p.id} className="glass" onClick={() => setSelected(isSel ? null : p.id)}
                style={{ padding:0, overflow:'hidden', cursor:'pointer', transition:'box-shadow 0.2s, border-color 0.2s',
                  border: isSel ? `1.5px solid ${sc}55` : '1px solid rgba(255,255,255,0.82)',
                  boxShadow: isSel ? `0 6px 36px ${sc}22` : '0 4px 32px rgba(26,54,93,0.07)' }}>
                {/* é¡ä¼¼åº¦ãƒãƒ¼ */}
                <div style={{ height:3, background:`linear-gradient(to right, ${sc}, ${sc}66)`, width:`${p.score}%`, transition:'width 0.5s' }}/>
                <div style={{ padding:'16px 20px' }}>
                  <div style={{ display:'flex', alignItems:'flex-start', gap:14, marginBottom:10 }}>
                    <div style={{ flex:1 }}>
                      <div style={{ fontSize:14, fontWeight:700, color:C.text, lineHeight:1.6, marginBottom:4 }}>{p.title}</div>
                      <div style={{ fontSize:11.5, color:C.textMid, marginBottom:3 }}>{p.authors}</div>
                      <div style={{ fontSize:11, color:C.textLight }}>
                        <span style={{ fontWeight:600, color:C.primaryLight }}>{p.journal}</span>ã€€{p.year}å¹´ã€€<span style={{ background:'rgba(26,54,93,0.07)', padding:'1px 7px', borderRadius:999, fontSize:10.5, fontWeight:600, color:C.textMid }}>{p.design}</span>
                      </div>
                    </div>
                    {/* ã‚¹ã‚³ã‚¢ãƒãƒƒã‚¸ */}
                    <div style={{ flexShrink:0, textAlign:'center', background:sc+'18', border:`2px solid ${sc}44`, borderRadius:14, padding:'10px 16px', minWidth:70, boxShadow:`0 2px 12px ${sc}22` }}>
                      <div style={{ fontSize:22, fontWeight:800, color:sc, lineHeight:1, letterSpacing:'-0.02em' }}>{p.score}<span style={{ fontSize:12 }}>%</span></div>
                      <div style={{ fontSize:9.5, color:C.textLight, marginTop:3, fontWeight:600 }}>é¡ä¼¼åº¦</div>
                    </div>
                  </div>

                  {/* ã‚¿ã‚°ç¾¤ */}
                  <div style={{ display:'flex', flexWrap:'wrap', gap:5, marginBottom:10 }}>
                    {p.diseases.map(d => <span key={d} className="chip-disease" style={{ padding:'2px 9px', borderRadius:999, fontSize:10.5, fontWeight:600 }}>{d}</span>)}
                    {p.drugs.map(d => <span key={d} className="chip-drug" style={{ padding:'2px 9px', borderRadius:999, fontSize:10.5, fontWeight:600 }}>{d}</span>)}
                    <span style={{ padding:'2px 9px', borderRadius:999, fontSize:10.5, fontWeight:600, background:'rgba(26,54,93,0.06)', color:C.textMid, border:'1px solid rgba(26,54,93,0.11)' }}>ğŸ‘¥ {p.ageRange}</span>
                    <span style={{ padding:'2px 9px', borderRadius:999, fontSize:10.5, fontWeight:600, background:'rgba(26,54,93,0.06)', color:C.textMid, border:'1px solid rgba(26,54,93,0.11)' }}>n={p.n.toLocaleString()}</span>
                    {p.dataSources.map(d => <span key={d} style={{ padding:'2px 9px', borderRadius:999, fontSize:10.5, fontWeight:600, background:'rgba(55,105,175,0.09)', color:C.primaryLight, border:'1px solid rgba(55,105,175,0.18)' }}>{d}</span>)}
                  </div>

                  {/* ãƒãƒƒãƒãƒã‚¤ãƒ³ãƒˆ */}
                  <div style={{ display:'flex', alignItems:'center', gap:5, flexWrap:'wrap' }}>
                    <span style={{ fontSize:10, color:C.textLight, fontWeight:600, marginRight:2 }}>ãƒãƒƒãƒï¼š</span>
                    {p.matchPoints.map(m => (
                      <span key={m} style={{ fontSize:10, color:sc, background:sc+'12', border:`1px solid ${sc}28`, borderRadius:999, padding:'1px 7px', fontWeight:700 }}>âœ“ {m}</span>
                    ))}
                  </div>

                  {/* å±•é–‹: ã‚¢ãƒ–ã‚¹ãƒˆãƒ©ã‚¯ãƒˆ + ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ */}
                  {isSel && (
                    <div className="fade-in">
                      <div style={{ borderTop:'1px solid rgba(26,54,93,0.09)', margin:'14px 0 0', paddingTop:14 }}>
                        <div style={{ fontSize:10, color:C.textLight, marginBottom:7, fontWeight:700, letterSpacing:'0.05em', textTransform:'uppercase' }}>ã‚¢ãƒ–ã‚¹ãƒˆãƒ©ã‚¯ãƒˆ</div>
                        <p style={{ fontSize:12.5, color:C.textMid, lineHeight:1.80 }}>{p.abstract}</p>
                      </div>
                      <div style={{ display:'flex', gap:8, marginTop:14, paddingTop:12, borderTop:'1px solid rgba(26,54,93,0.06)', flexWrap:'wrap' }}>
                        <button className="btn-primary" style={{ padding:'9px 18px', fontSize:12 }}
                          onClick={e => { e.stopPropagation(); setTab('cohort'); }}>
                          ğŸ“Š ã‚³ãƒ›ãƒ¼ãƒˆæ¡ä»¶ã«åæ˜ ã™ã‚‹
                        </button>
                        <button className="btn-outline" style={{ padding:'9px 18px', fontSize:12 }}
                          onClick={e => e.stopPropagation()}>
                          ğŸ“„ å…¨æ–‡ã‚’å‚ç…§ã™ã‚‹
                        </button>
                        <button className="btn-outline" style={{ padding:'9px 18px', fontSize:12 }}
                          onClick={e => e.stopPropagation()}>
                          ğŸ”– ä¿å­˜ã™ã‚‹
                        </button>
                      </div>
                    </div>
                  )}
                </div>
              </div>
            );
          })}
        </div>
      </div>
    </div>
  );
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ç”»é¢1: ãƒ›ãƒ¼ãƒ 
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function HomeScreen({ setTab }) {
  const todos = [
    { icon:'ğŸ“‹', text:'ç ”ç©¶è¨ˆç”»æ›¸ã®æœ€çµ‚ç¢ºèªãƒ»æ‰¿èª', deadline:'2026/02/28', pri:'high' },
    { icon:'ğŸ“¤', text:'å¤§åˆåŒå§”å“¡ä¼šã¸ã®ç”³è«‹æ›¸é¡æå‡º', deadline:'2026/03/15', pri:'mid' },
    { icon:'âœï¸', text:'ãƒ‡ãƒ¼ã‚¿åˆ©ç”¨å¥‘ç´„æ›¸ã®é›»å­ç½²å',  deadline:'2026/03/20', pri:'low' },
  ];
  const priS = {
    high: { bg:'rgba(220,38,38,0.08)',  text:'#B91C1C', border:'rgba(220,38,38,0.18)',  label:'è¦å¯¾å¿œ' },
    mid:  { bg:'rgba(249,115,22,0.08)', text:'#C2570D', border:'rgba(249,115,22,0.20)', label:'ä»Šé€±ä¸­' },
    low:  { bg:'rgba(5,150,105,0.08)',  text:'#065F46', border:'rgba(5,150,105,0.18)',  label:'ä»Šæœˆä¸­' },
  };
  const steps = [
    { label:'ç ”ç©¶ç™»éŒ²',   done:true },
    { label:'äº‹å‰èª¿æŸ»',   done:true },
    { label:'ç”³è«‹æ›¸ä½œæˆ', done:false, current:true },
    { label:'å€«ç†å¯©æŸ»',   done:false },
    { label:'å¤§åˆåŒå§”',   done:false },
    { label:'ãƒ‡ãƒ¼ã‚¿æä¾›', done:false },
  ];
  const doneIdx = steps.findIndex(s => s.current);
  const actions = [
    { icon:'ğŸ”', title:'é¡ä¼¼ç ”ç©¶ã‚’æ¢ã™', desc:'ã‚­ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ¸ˆã¿2,847ä»¶ã®å…ˆè¡Œç ”ç©¶ã‹ã‚‰\né¡ä¼¼æ¡ä»¶ã®ç ”ç©¶ã‚’è‡ªå‹•æ¨è–¦', tab:'search', hot:false },
    { icon:'ğŸ“Š', title:'ã‚³ãƒ›ãƒ¼ãƒˆæ¡ä»¶ã‚’è¨­å®šã™ã‚‹', desc:'ICD-10ãƒ»åŒ»è–¬å“åã§å¯¾è±¡é›†å›£ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å¯è¦–åŒ–\nç ”ç©¶ãƒ•ã‚£ãƒ¼ã‚¸ãƒ“ãƒªãƒ†ã‚£ã‚’å³åº§ã«ç¢ºèª', tab:'cohort', hot:true },
    { icon:'ğŸ¤–', title:'AIã‚¢ã‚·ã‚¹ãƒˆã§åˆ†æã™ã‚‹', desc:'æ—¥æœ¬èªã§è³ªå•ã™ã‚‹ã ã‘ã€‚SQLä¸è¦ã®ç›´æ„Ÿçš„åˆ†æ\nè‡ªå‹•ã‚°ãƒ©ãƒ•ç”Ÿæˆãƒ»ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰é€£æº', tab:'ai', hot:false },
  ];
  return (
    <div className="slide-up">
      {/* ã‚¦ã‚§ãƒ«ã‚«ãƒ ãƒãƒŠãƒ¼ */}
      <div className="glass-banner" style={{ padding:'28px 32px', marginBottom:22, color:'white' }}>
        <div style={{ position:'absolute', right:0, top:0, bottom:0, width:300, background:'radial-gradient(ellipse at 60% 50%, rgba(249,115,22,0.22) 0%, transparent 72%)', pointerEvents:'none' }}/>
        <div style={{ position:'relative' }}>
          <div style={{ fontSize:11, color:'rgba(147,197,253,0.85)', marginBottom:5, letterSpacing:'0.06em', textTransform:'uppercase' }}>2026å¹´2æœˆ25æ—¥ï¼ˆæ°´ï¼‰</div>
          <h1 style={{ fontSize:22, fontWeight:700, marginBottom:7, letterSpacing:'-0.02em' }}>å¤ªéƒ ã•ã‚“ã€ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™ ğŸ‘‹</h1>
          <p style={{ fontSize:13, color:'rgba(191,219,254,0.85)', marginBottom:20, lineHeight:1.6 }}>åˆ†æãƒãƒ¼ãƒ  ï¼ ç ”ç©¶ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã€Œé«˜é½¢è€…ç³–å°¿ç—…ã‚³ãƒ›ãƒ¼ãƒˆç ”ç©¶2024ã€</p>
          <div style={{ display:'flex', gap:10, flexWrap:'wrap' }}>
            {[
              ['ğŸ“‹ æœªå®Œäº†ã‚¿ã‚¹ã‚¯','3ä»¶',null],
              ['âš¡ ç”³è«‹æœŸé™ã¾ã§','18æ—¥','rgba(249,115,22,0.30)'],
              ['ğŸ—„ï¸ åˆ©ç”¨å¯èƒ½ãƒ‡ãƒ¼ã‚¿','NDBãƒ»DPCãƒ»ãƒ¬ã‚»ãƒ—ãƒˆ',null],
            ].map(([l,v,bg]) => (
              <div key={l} style={{ background:bg||'rgba(255,255,255,0.10)', border:bg?'1px solid rgba(249,115,22,0.40)':'1px solid rgba(255,255,255,0.12)', borderRadius:10, padding:'7px 14px', fontSize:12, backdropFilter:'blur(8px)' }}>
                {l}: <strong style={{ color:bg?'#FED7AA':'rgba(255,255,255,0.95)' }}>{v}</strong>
              </div>
            ))}
          </div>
        </div>
      </div>

      <div style={{ display:'grid', gridTemplateColumns:'1fr 1fr', gap:20, marginBottom:20 }}>
        <Card>
          <SectionTitle>ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹</SectionTitle>
          <div style={{ display:'flex', flexDirection:'column', gap:10 }}>
            {actions.map((a,i) => (
              <button key={i} onClick={() => setTab(a.tab)}
                className={a.hot ? 'action-card-hot' : 'action-card'}
                style={{ padding:'14px 18px', display:'flex', alignItems:'center', gap:14, width:'100%', border:'none' }}>
                <div style={{ width:44, height:44, borderRadius:11, background:a.hot?'rgba(255,255,255,0.14)':'linear-gradient(135deg,rgba(26,54,93,0.88),rgba(40,68,116,0.80))', display:'flex', alignItems:'center', justifyContent:'center', fontSize:20, flexShrink:0, boxShadow:a.hot?'none':'0 2px 8px rgba(26,54,93,0.18)' }}>{a.icon}</div>
                <div style={{ flex:1 }}>
                  <div style={{ fontSize:14, fontWeight:700, color:a.hot?'rgba(255,255,255,0.96)':C.text, marginBottom:2, letterSpacing:'-0.01em' }}>{a.title}</div>
                  <div style={{ fontSize:11, color:a.hot?'rgba(191,219,254,0.80)':C.textLight, whiteSpace:'pre-line', lineHeight:1.55 }}>{a.desc}</div>
                </div>
                <span style={{ color:a.hot?'rgba(147,197,253,0.70)':C.textLight, fontSize:18, flexShrink:0 }}>â€º</span>
              </button>
            ))}
          </div>
        </Card>

        <Card>
          <SectionTitle>æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆTODOï¼‰</SectionTitle>
          <div style={{ display:'flex', flexDirection:'column', gap:9 }}>
            {todos.map((t,i) => {
              const s = priS[t.pri];
              return (
                <div key={i} style={{ background:'rgba(255,255,255,0.50)', border:`1px solid ${s.border}`, borderRadius:11, padding:'11px 15px', display:'flex', alignItems:'center', gap:12, backdropFilter:'blur(8px)' }}>
                  <span style={{ fontSize:18 }}>{t.icon}</span>
                  <div style={{ flex:1 }}>
                    <div style={{ fontSize:13, fontWeight:500, color:C.text, marginBottom:2 }}>{t.text}</div>
                    <div style={{ fontSize:11, color:C.textLight }}>æœŸé™: {t.deadline}</div>
                  </div>
                  <span style={{ padding:'3px 10px', borderRadius:999, fontSize:10, fontWeight:700, background:s.bg, color:s.text, border:`1px solid ${s.border}`, flexShrink:0, whiteSpace:'nowrap' }}>{s.label}</span>
                </div>
              );
            })}
          </div>
          <div style={{ marginTop:14, padding:'10px 14px', background:'rgba(251,191,36,0.08)', border:'1px solid rgba(251,191,36,0.28)', borderRadius:10, display:'flex', gap:8, fontSize:12, color:'#92400E' }}>
            <span>ğŸ’¡</span><span>ã€Œé«˜é½¢è€…ç³–å°¿ç—…ã€ã®é¡ä¼¼ç ”ç©¶ãŒ2ä»¶æ–°ãŸã«å…¬é–‹ã•ã‚Œã¾ã—ãŸã€‚</span>
          </div>
        </Card>
      </div>

      <Card>
        <SectionTitle>ç”³è«‹ãƒ»å¯©æŸ»ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</SectionTitle>
        <div style={{ display:'flex', alignItems:'center', padding:'10px 0 4px' }}>
          {steps.map((s,i) => (
            <React.Fragment key={s.label}>
              <div style={{ display:'flex', flexDirection:'column', alignItems:'center', flex:1, minWidth:0 }}>
                <div style={{ width:38, height:38, borderRadius:'50%', display:'flex', alignItems:'center', justifyContent:'center', fontSize:14, fontWeight:700, background:s.done?'linear-gradient(135deg,#1A365D,#3769AF)':s.current?'linear-gradient(135deg,#F97316,#FBBF24)':'rgba(26,54,93,0.10)', color:(s.done||s.current)?'white':C.textLight, boxShadow:s.done?'0 2px 10px rgba(26,54,93,0.30)':s.current?'0 2px 14px rgba(249,115,22,0.45), 0 0 0 4px rgba(249,115,22,0.15)':'none', position:'relative', zIndex:1 }}>
                  {s.done?'âœ“':i+1}
                </div>
                <div style={{ fontSize:10, marginTop:7, fontWeight:s.current?700:400, color:s.done?C.primaryLight:s.current?C.accent:C.textLight, textAlign:'center', whiteSpace:'nowrap' }}>
                  {s.label}{s.current&&<div style={{ fontSize:9, color:C.accent, marginTop:1 }}>â—€ ç¾åœ¨åœ°</div>}
                </div>
              </div>
              {i < steps.length-1 && <div style={{ height:2, flex:1, background:i<doneIdx?'linear-gradient(to right,#3769AF,#5B8DD9)':'rgba(26,54,93,0.12)', position:'relative', top:-16, margin:'0 -2px', borderRadius:1 }}/>}
            </React.Fragment>
          ))}
        </div>
      </Card>
    </div>
  );
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ç”»é¢2: ã‚³ãƒ›ãƒ¼ãƒˆå‚ç…§ï¼ˆå®Œå…¨ãƒªã‚¢ã‚¯ãƒ†ã‚£ãƒ–ç‰ˆï¼‰
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function CohortScreen() {
  const [query, setQuery]     = useState('');
  const [tags, setTags]       = useState([
    { id:1, label:'E11 2å‹ç³–å°¿ç—…',      type:'disease' },
    { id:2, label:'I10 æœ¬æ…‹æ€§é«˜è¡€åœ§ç—‡',  type:'disease' },
    { id:3, label:'ãƒ¡ãƒˆãƒ›ãƒ«ãƒŸãƒ³',         type:'drug'    },
  ]);
  const [ageMin, setAgeMin]     = useState(60);
  const [ageMax, setAgeMax]     = useState(85);
  const [gender, setGender]     = useState('all');
  const [logic, setLogic]       = useState('AND');
  const [obsStart, setObsStart] = useState('2021');
  const [obsEnd, setObsEnd]     = useState('2023');
  const [showSug, setShowSug]   = useState(false);
  const [busy, setBusy]         = useState(false);
  const [animKey, setAnimKey]   = useState(0);

  useEffect(() => {
    setBusy(true);
    const t = setTimeout(() => { setBusy(false); setAnimKey(k => k+1); }, 380);
    return () => clearTimeout(t);
  }, [tags, logic, ageMin, ageMax, gender, obsStart, obsEnd]);

  const n = useMemo(() => calcN(tags, logic, ageMin, ageMax, gender, obsStart, obsEnd),
    [tags, logic, ageMin, ageMax, gender, obsStart, obsEnd]);

  const COMORB_RATES = [
    { l:'é«˜è¡€åœ§', r:0.61 }, { l:'è„‚è³ªç•°å¸¸', r:0.50 },
    { l:'CKD',   r:0.30 }, { l:'å¿ƒä¸å…¨',   r:0.17 }, { l:'è„³å’ä¸­', r:0.15 },
  ];
  const comorbData = COMORB_RATES.map(d => ({ l:d.l, v:Math.round(d.r * n) }));

  const TREND_SHAPE = { '2018':0.64,'2019':0.70,'2020':0.58,'2021':0.74,'2022':0.88,'2023':1.00 };
  const trendData = Object.entries(TREND_SHAPE)
    .filter(([y]) => parseInt(y) >= parseInt(obsStart) && parseInt(y) <= parseInt(obsEnd))
    .map(([y,f]) => ({ l:`'${y.slice(2)}`, v:Math.max(10, Math.round(n * f / 100)) }));

  const suggestions = [
    { label:'E11 2å‹ç³–å°¿ç—…',       type:'disease' },
    { label:'E14 è©³ç´°ä¸æ˜ã®ç³–å°¿ç—…',  type:'disease' },
    { label:'N18 æ…¢æ€§è…è‡“ç—…(CKD)',  type:'disease' },
    { label:'I25 æ…¢æ€§è™šè¡€æ€§å¿ƒç–¾æ‚£', type:'disease' },
    { label:'E78 è„‚è³ªç•°å¸¸ç—‡',       type:'disease' },
    { label:'F00 ã‚¢ãƒ«ãƒ„ãƒã‚¤ãƒãƒ¼ç—…', type:'disease' },
    { label:'ã‚¤ãƒ³ã‚¹ãƒªãƒ³è£½å‰¤',       type:'drug' },
    { label:'SGLT2é˜»å®³è–¬',         type:'drug' },
    { label:'GLP-1å—å®¹ä½“ä½œå‹•è–¬',   type:'drug' },
    { label:'DPP-4é˜»å®³è–¬',         type:'drug' },
  ];
  const filtered = query.length > 0 ? suggestions.filter(s => s.label.includes(query)) : suggestions.slice(0,6);
  const addTag = s => { if(tags.find(t=>t.label===s.label))return; setTags(p=>[...p,{id:Date.now(),...s}]); setQuery(''); setShowSug(false); };
  const removeTag = id => setTags(p => p.filter(t => t.id !== id));
  const lo = Math.min(ageMin, ageMax), hi = Math.max(ageMin, ageMax);
  const privacyWarn = n < 100;

  const inputStyle = { width:'100%', padding:'9px 13px', fontSize:13, color:C.text };
  const selectStyle = { flex:1, padding:'8px 10px', fontSize:12, color:C.text };

  return (
    <div className="slide-up" style={{ display:'grid', gridTemplateColumns:'390px 1fr', gap:20, minHeight:660 }}>

      {/* â”€â”€â”€ å·¦ãƒšã‚¤ãƒ³ â”€â”€â”€ */}
      <Card style={{ display:'flex', flexDirection:'column', gap:16, padding:22 }}>
        <div>
          <h2 style={{ fontSize:15, fontWeight:700, color:C.text, marginBottom:3, letterSpacing:'-0.02em' }}>ğŸ” ç ”ç©¶å¯¾è±¡æ¡ä»¶ã®è¨­å®š</h2>
          <p style={{ fontSize:11, color:C.textLight, lineHeight:1.5 }}>æ¡ä»¶ã‚’å¤‰ãˆã‚‹ã¨å³å›³ãŒãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§æ›´æ–°ã•ã‚Œã¾ã™</p>
        </div>

        {/* å‚·ç—…åãƒ»è–¬å“æ¤œç´¢ */}
        <div>
          <label style={{ fontSize:11, fontWeight:700, color:C.textMid, display:'block', marginBottom:6, letterSpacing:'0.04em', textTransform:'uppercase' }}>
            å‚·ç—…åãƒ»åŒ»è–¬å“ã‚’è¿½åŠ 
          </label>
          <div style={{ position:'relative' }}>
            <input value={query}
              onChange={e => { setQuery(e.target.value); setShowSug(true); }}
              onFocus={() => setShowSug(true)}
              onBlur={() => setTimeout(() => setShowSug(false), 150)}
              placeholder="ä¾‹ï¼š2å‹ç³–å°¿ç—…ã€E11ã€ãƒ¡ãƒˆãƒ›ãƒ«ãƒŸãƒ³â€¦"
              className="input-glass"
              style={inputStyle}/>
            {showSug && filtered.length > 0 && (
              <div className="glass fade-in" style={{ position:'absolute', top:'calc(100% + 6px)', left:0, right:0, zIndex:200, overflow:'hidden', padding:4 }}>
                {filtered.map((s,i) => (
                  <div key={i} onMouseDown={() => addTag(s)}
                    style={{ padding:'8px 12px', cursor:'pointer', display:'flex', alignItems:'center', gap:8, fontSize:12, borderRadius:10, transition:'background 0.12s', color:C.text }}
                    onMouseEnter={e => e.currentTarget.style.background='rgba(26,54,93,0.06)'}
                    onMouseLeave={e => e.currentTarget.style.background='transparent'}>
                    <span style={{ padding:'2px 7px', borderRadius:5, fontSize:9.5, fontWeight:700, letterSpacing:'0.04em', background:s.type==='disease'?'rgba(55,105,175,0.12)':'rgba(249,115,22,0.10)', color:s.type==='disease'?C.primaryLight:'#C2570D', border:`1px solid ${s.type==='disease'?'rgba(55,105,175,0.22)':'rgba(249,115,22,0.22)'}` }}>
                      {s.type==='disease'?'ICD':'è–¬å“'}
                    </span>
                    {s.label}
                    {tags.find(t=>t.label===s.label) && <span style={{ marginLeft:'auto', fontSize:10, color:C.textLight }}>âœ“ è¿½åŠ æ¸ˆ</span>}
                  </div>
                ))}
              </div>
            )}
          </div>
        </div>

        {/* é¸æŠä¸­ã‚¿ã‚° */}
        <div>
          <label style={{ fontSize:11, fontWeight:700, color:C.textMid, display:'block', marginBottom:6, letterSpacing:'0.04em', textTransform:'uppercase' }}>
            é¸æŠä¸­ã®æ¡ä»¶ <span style={{ fontWeight:400, fontSize:11, color:C.textLight, textTransform:'none', letterSpacing:0 }}>({tags.length}ä»¶)</span>
          </label>
          <div style={{ display:'flex', flexWrap:'wrap', gap:6, minHeight:46, padding:'8px 10px', background:'rgba(26,54,93,0.04)', borderRadius:10, border:`1px dashed rgba(26,54,93,0.18)` }}>
            {tags.map(t => (
              <span key={t.id} className={t.type==='disease'?'chip-disease':'chip-drug'}
                style={{ display:'inline-flex', alignItems:'center', gap:4, padding:'4px 10px', borderRadius:999, fontSize:12, fontWeight:600, backdropFilter:'blur(8px)' }}>
                {t.label}
                <button onClick={() => removeTag(t.id)} style={{ background:'none', border:'none', cursor:'pointer', fontSize:14, lineHeight:1, opacity:0.50, color:'inherit', padding:0, marginLeft:1 }}>Ã—</button>
              </span>
            ))}
            {tags.length===0 && <span style={{ fontSize:12, color:C.textLight, alignSelf:'center' }}>æ¡ä»¶ã‚’è¿½åŠ ã—ã¦ãã ã•ã„</span>}
          </div>
        </div>

        {/* AND/OR */}
        <div style={{ display:'flex', gap:8, alignItems:'center', background:'rgba(26,54,93,0.05)', borderRadius:9, padding:'8px 12px', border:`1px solid rgba(26,54,93,0.08)` }}>
          <span style={{ fontSize:11, color:C.textMid, flexShrink:0, fontWeight:600 }}>çµã‚Šè¾¼ã¿æ–¹æ³•:</span>
          {[['AND','ANDï¼ˆå…¨ã¦è©²å½“ï¼‰'],['OR','ORï¼ˆã„ãšã‚Œã‹ï¼‰']].map(([v,l]) => (
            <label key={v} style={{ display:'flex', alignItems:'center', gap:5, fontSize:12, cursor:'pointer', color:logic===v?C.primary:C.textLight, fontWeight:logic===v?700:400, transition:'color 0.15s' }}>
              <input type="radio" name="logic" checked={logic===v} onChange={() => setLogic(v)} style={{ accentColor:C.primary }}/>
              {l}
            </label>
          ))}
        </div>

        {/* å¹´é½¢ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ */}
        <div>
          <label style={{ fontSize:11, fontWeight:700, color:C.textMid, display:'block', marginBottom:8, letterSpacing:'0.04em', textTransform:'uppercase' }}>
            å¹´é½¢ç¯„å›²
            <span style={{ color:C.accent, fontWeight:700, marginLeft:8, textTransform:'none', letterSpacing:0, fontSize:13 }}>{lo}æ­³ ã€œ {hi}æ­³</span>
            <span style={{ fontSize:10, color:C.textLight, fontWeight:400, marginLeft:6, textTransform:'none', letterSpacing:0 }}>(å¹…: {hi-lo}æ­³)</span>
          </label>
          <div style={{ position:'relative', height:5, background:'rgba(26,54,93,0.10)', borderRadius:3, margin:'10px 0 4px' }}>
            <div style={{ position:'absolute', left:`${lo}%`, right:`${100-hi}%`, top:0, bottom:0, background:`linear-gradient(to right,${C.primary},${C.primaryLight})`, borderRadius:3 }}/>
          </div>
          <input type="range" min={0} max={100} value={ageMin} onChange={e => setAgeMin(+e.target.value)} style={{ width:'100%', accentColor:C.primary, cursor:'pointer', marginBottom:4 }}/>
          <input type="range" min={0} max={100} value={ageMax} onChange={e => setAgeMax(+e.target.value)} style={{ width:'100%', accentColor:C.accent, cursor:'pointer' }}/>
          <div style={{ display:'flex', justifyContent:'space-between', fontSize:10, color:C.textLight, marginTop:3 }}>
            <span>0æ­³</span><span>25æ­³</span><span>50æ­³</span><span>75æ­³</span><span>100æ­³</span>
          </div>
        </div>

        {/* æ€§åˆ¥ */}
        <div>
          <label style={{ fontSize:11, fontWeight:700, color:C.textMid, display:'block', marginBottom:8, letterSpacing:'0.04em', textTransform:'uppercase' }}>æ€§åˆ¥</label>
          <div style={{ display:'flex', gap:6 }}>
            {[['all','å…¨ã¦'],['male','ç”·æ€§ã®ã¿'],['female','å¥³æ€§ã®ã¿']].map(([v,l]) => (
              <button key={v} onClick={() => setGender(v)}
                style={{ flex:1, padding:'8px 0', borderRadius:9, fontSize:12, fontWeight:gender===v?700:400, cursor:'pointer', transition:'all 0.16s', border:`1.5px solid ${gender===v?C.primary:'rgba(26,54,93,0.15)'}`, background:gender===v?C.primary:'rgba(255,255,255,0.55)', color:gender===v?'white':C.textMid, backdropFilter:'blur(8px)', boxShadow:gender===v?'0 2px 10px rgba(26,54,93,0.25)':'none' }}>
                {l}
              </button>
            ))}
          </div>
        </div>

        {/* è¦³å¯ŸæœŸé–“ */}
        <div>
          <label style={{ fontSize:11, fontWeight:700, color:C.textMid, display:'block', marginBottom:8, letterSpacing:'0.04em', textTransform:'uppercase' }}>
            è¦³å¯ŸæœŸé–“ <span style={{ fontSize:10, color:C.textLight, fontWeight:400, textTransform:'none', letterSpacing:0 }}>ï¼ˆåºƒã’ã‚‹ã¨å¯¾è±¡è€…å¢—ï¼‰</span>
          </label>
          <div style={{ display:'flex', gap:8, alignItems:'center' }}>
            <select value={obsStart} onChange={e => setObsStart(e.target.value)} className="input-glass" style={selectStyle}>
              {['2018','2019','2020','2021'].map(y => <option key={y} value={y}>{y}å¹´</option>)}
            </select>
            <span style={{ fontSize:12, color:C.textLight, flexShrink:0 }}>ã€œ</span>
            <select value={obsEnd} onChange={e => setObsEnd(e.target.value)} className="input-glass" style={selectStyle}>
              {['2019','2020','2021','2022','2023'].map(y => <option key={y} value={y}>{y}å¹´</option>)}
            </select>
          </div>
        </div>

        {/* ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ */}
        <div>
          <label style={{ fontSize:11, fontWeight:700, color:C.textMid, display:'block', marginBottom:8, letterSpacing:'0.04em', textTransform:'uppercase' }}>ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹</label>
          {[['NDBï¼ˆãƒ¬ã‚»ãƒ—ãƒˆï¼‰',true],['DPCãƒ‡ãƒ¼ã‚¿',true],['é›»å­ã‚«ãƒ«ãƒ†ï¼ˆè©¦é¨“çš„ï¼‰',false]].map(([name,chk]) => (
            <label key={name} style={{ display:'flex', alignItems:'center', gap:9, fontSize:12, color:C.textMid, cursor:'pointer', marginBottom:7 }}>
              <input type="checkbox" defaultChecked={chk} style={{ accentColor:C.primary, width:14, height:14 }}/>
              {name}
              {name.includes('è©¦é¨“') && <span style={{ fontSize:9.5, background:'rgba(249,115,22,0.10)', color:'#C2570D', padding:'2px 6px', borderRadius:5, fontWeight:700, border:'1px solid rgba(249,115,22,0.22)' }}>Beta</span>}
            </label>
          ))}
        </div>

        <button className="btn-primary" style={{ marginTop:'auto', padding:'13px', fontSize:14, display:'flex', alignItems:'center', justifyContent:'center', gap:8, letterSpacing:'-0.01em' }}>
          {busy ? <span className="spin" style={{ display:'inline-block', fontSize:16 }}>âŸ³</span> : 'ğŸ”„'} å¯¾è±¡é›†å›£ã‚’ç¢ºå®šã—ã¦ç”³è«‹ã¸é€²ã‚€
        </button>
      </Card>

      {/* â”€â”€â”€ å³ãƒšã‚¤ãƒ³ â”€â”€â”€ */}
      <div style={{ display:'flex', flexDirection:'column', gap:14 }}>

        {/* ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã‚¢ãƒ©ãƒ¼ãƒˆ */}
        {privacyWarn && (
          <div className="fade-in" style={{ background:'rgba(220,38,38,0.08)', border:'1px solid rgba(220,38,38,0.22)', borderRadius:11, padding:'11px 16px', display:'flex', alignItems:'center', gap:10, fontSize:13, color:'#991B1B', backdropFilter:'blur(12px)' }}>
            <span style={{ fontSize:18 }}>âš ï¸</span>
            <strong>ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ä¿è­·ã‚¢ãƒ©ãƒ¼ãƒˆï¼š</strong> n &lt; 10 ã®ãŸã‚å€‹äººç‰¹å®šãƒªã‚¹ã‚¯ã‚ã‚Šã€‚æ•°å€¤ã¯éè¡¨ç¤ºã§ã™ã€‚æ¡ä»¶ã‚’ç·©å’Œã—ã¦ãã ã•ã„ã€‚
          </div>
        )}

        {/* næ•°ãƒãƒŠãƒ¼ */}
        <div className="glass-banner" style={{ padding:'24px 28px', display:'flex', alignItems:'center', justifyContent:'space-between', color:'white' }}>
          <div style={{ position:'relative' }}>
            <div style={{ fontSize:11, color:'rgba(147,197,253,0.80)', marginBottom:5, letterSpacing:'0.05em', textTransform:'uppercase' }}>
              æ¡ä»¶ã«åˆè‡´ã™ã‚‹æ¨å®šå¯¾è±¡è€…æ•°ï¼ˆNDB {obsStart}â€“{obsEnd}å¹´ï¼‰
            </div>
            <div key={animKey} className="count-anim" style={{ display:'flex', alignItems:'baseline', gap:8 }}>
              {busy ? (
                <div style={{ fontSize:44, fontWeight:700, opacity:0.45, letterSpacing:'-0.03em' }}>è¨ˆç®—ä¸­â€¦</div>
              ) : privacyWarn ? (
                <div style={{ fontSize:44, fontWeight:700, color:'rgba(252,165,165,0.90)' }}>ï¼Šï¼Šï¼Š</div>
              ) : (
                <div style={{ fontSize:44, fontWeight:700, letterSpacing:'-0.04em' }}>
                  ç´„ <span style={{ color:'#FB923C', textShadow:'0 2px 16px rgba(249,115,22,0.50)' }}>{n.toLocaleString()}</span>
                </div>
              )}
              {!busy && !privacyWarn && <div style={{ fontSize:20, opacity:0.70 }}>å</div>}
            </div>
            <div style={{ fontSize:11, color:'rgba(147,197,253,0.72)', marginTop:5, display:'flex', gap:8, flexWrap:'wrap', alignItems:'center' }}>
              <span>â€» n &lt; 10 ã®å ´åˆã¯ã€Œï¼Šã€éè¡¨ç¤ºï¼ˆå€‹äººç‰¹å®šé˜²æ­¢ï¼‰</span>
              {gender!=='all' && <span style={{ background:'rgba(249,115,22,0.25)', border:'1px solid rgba(249,115,22,0.30)', padding:'1px 8px', borderRadius:5, fontSize:10 }}>{gender==='male'?'â™‚ ç”·æ€§ã®ã¿':'â™€ å¥³æ€§ã®ã¿'}</span>}
              {logic==='OR' && <span style={{ background:'rgba(16,185,129,0.22)', border:'1px solid rgba(16,185,129,0.30)', padding:'1px 8px', borderRadius:5, fontSize:10 }}>ORæ‹¡å¤§ãƒ¢ãƒ¼ãƒ‰</span>}
            </div>
          </div>
          <div style={{ display:'flex', flexDirection:'column', gap:8, flexShrink:0 }}>
            <div style={{ background:'rgba(255,255,255,0.09)', border:'1px solid rgba(255,255,255,0.12)', borderRadius:10, padding:'9px 16px', textAlign:'right', backdropFilter:'blur(8px)' }}>
              <div style={{ fontSize:9.5, color:'rgba(147,197,253,0.70)', textTransform:'uppercase', letterSpacing:'0.06em' }}>ãƒ‡ãƒ¼ã‚¿æ›´æ–°æ—¥</div>
              <div style={{ fontSize:13, fontWeight:600, marginTop:2 }}>2026å¹´1æœˆ31æ—¥</div>
            </div>
            <div style={{ background:'rgba(16,185,129,0.15)', border:'1px solid rgba(16,185,129,0.28)', borderRadius:10, padding:'9px 16px', textAlign:'right', backdropFilter:'blur(8px)' }}>
              <div style={{ fontSize:9.5, color:'rgba(110,231,183,0.80)', textTransform:'uppercase', letterSpacing:'0.06em' }}>æ¨å®šä¿¡é ¼åº¦</div>
              <div style={{ fontSize:14, fontWeight:700, color:'#6EE7B7', marginTop:2 }}>Â±5%ï¼ˆ95%CIï¼‰</div>
            </div>
          </div>
        </div>

        {/* ãƒãƒ£ãƒ¼ãƒˆã‚°ãƒªãƒƒãƒ‰ */}
        <div style={{ display:'grid', gridTemplateColumns:'1fr 1fr', gap:14 }}>
          <Card style={{ padding:18 }}>
            <div style={{ display:'flex', justifyContent:'space-between', alignItems:'flex-start', marginBottom:10 }}>
              <h3 style={{ fontSize:12, fontWeight:700, color:C.text, letterSpacing:'-0.01em' }}>å¹´é½¢ãƒ»æ€§åˆ¥åˆ†å¸ƒ</h3>
              <span style={{ fontSize:9.5, color:C.accent, fontWeight:600 }}>â–² ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ãƒ»æ€§åˆ¥ã¨é€£å‹•</span>
            </div>
            {privacyWarn
              ? <div style={{ textAlign:'center', padding:'20px 0', color:C.textLight, fontSize:12 }}>n ãŒå°‘ãªã™ãã‚‹ãŸã‚éè¡¨ç¤º</div>
              : <PyramidChart key={animKey} ageMin={ageMin} ageMax={ageMax} gender={gender}/>
            }
          </Card>
          <Card style={{ padding:18 }}>
            <div style={{ display:'flex', justifyContent:'space-between', alignItems:'flex-start', marginBottom:10 }}>
              <h3 style={{ fontSize:12, fontWeight:700, color:C.text, letterSpacing:'-0.01em' }}>ä¸»è¦åˆä½µç—‡ã®åˆ†å¸ƒ</h3>
              <span style={{ fontSize:9.5, color:C.accent, fontWeight:600 }}>â–² næ•°ã¨é€£å‹•</span>
            </div>
            {privacyWarn
              ? <div style={{ textAlign:'center', padding:'20px 0', color:C.textLight, fontSize:12 }}>n ãŒå°‘ãªã™ãã‚‹ãŸã‚éè¡¨ç¤º</div>
              : <BarChart key={animKey} data={comorbData} colorA="#2D4A7A" colorB="#5B8DD9"/>
            }
          </Card>
        </div>

        <Card style={{ padding:18 }}>
          <div style={{ display:'flex', justifyContent:'space-between', alignItems:'flex-start', marginBottom:10 }}>
            <h3 style={{ fontSize:12, fontWeight:700, color:C.text, letterSpacing:'-0.01em' }}>çµŒå¹´ãƒˆãƒ¬ãƒ³ãƒ‰ï¼ˆè¨ºæ–­ä»¶æ•° / 100åï¼‰</h3>
            <span style={{ fontSize:9.5, color:C.accent, fontWeight:600 }}>â–² è¦³å¯ŸæœŸé–“ãƒ»næ•°ã¨é€£å‹•</span>
          </div>
          {privacyWarn
            ? <div style={{ textAlign:'center', padding:'20px 0', color:C.textLight, fontSize:12 }}>n ãŒå°‘ãªã™ãã‚‹ãŸã‚éè¡¨ç¤º</div>
            : <LineChart key={animKey} data={trendData}/>
          }
        </Card>

        {/* ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒ¼ãƒ†ã‚£ã‚¹ */}
        <div style={{ background:'rgba(251,191,36,0.07)', border:'1px solid rgba(251,191,36,0.26)', borderRadius:11, padding:'12px 16px', display:'flex', gap:10, fontSize:11.5, color:'#78350F', backdropFilter:'blur(12px)' }}>
          <span style={{ fontSize:15, flexShrink:0 }}>ğŸ”’</span>
          <div>
            <strong style={{ fontSize:12 }}>å€‹äººæƒ…å ±ä¿è­·æªç½®ï¼ˆå€‹äººæƒ…å ±ã®ä¿è­·ã«é–¢ã™ã‚‹æ³•å¾‹ã«åŸºã¥ãï¼‰</strong>
            <ul style={{ margin:'5px 0 0 16px', lineHeight:2.0 }}>
              <li>è¡¨ç¤ºæ•°å€¤ã¯ <strong>n â‰¥ 10</strong> ã®å ´åˆã®ã¿é–‹ç¤ºï¼ˆn &lt; 10 ã¯ã€Œï¼Šã€è¡¨ç¤ºï¼‰</li>
              <li>å¹´é½¢ãƒ»æ€§åˆ¥ãƒ»åœ°åŸŸã®çµ„ã¿åˆã‚ã›ã§å€‹äººç‰¹å®šãƒªã‚¹ã‚¯ãŒã‚ã‚‹é›†è¨ˆã¯è‡ªå‹•æŠ‘åˆ¶</li>
              <li>æœ¬ç”»é¢ã®çµ±è¨ˆã¯ <strong>æ¢ç´¢ç›®çš„ï¼ˆãƒ•ã‚£ãƒ¼ã‚¸ãƒ“ãƒªãƒ†ã‚£ç¢ºèªï¼‰</strong> ã«é™å®šã€‚å®Ÿãƒ‡ãƒ¼ã‚¿æä¾›ã¯åˆ¥é€”ç”³è«‹ãŒå¿…è¦</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  );
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ç”»é¢3: AIåˆ†æã‚¢ã‚·ã‚¹ãƒˆ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function AIScreen() {
  const [msgs, setMsgs] = useState([
    { role:'system', text:'åŒ»ç™‚ãƒ‡ãƒ¼ã‚¿åˆ†æAIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã€ŒGenieã€ã¸ã‚ˆã†ã“ãã€‚\nNDBãƒ»DPCãƒ‡ãƒ¼ã‚¿ã«ã¤ã„ã¦æ—¥æœ¬èªã§ã”è³ªå•ãã ã•ã„ã€‚SQLã®çŸ¥è­˜ã¯ä¸è¦ã§ã™ã€‚' }
  ]);
  const [input, setInput]       = useState('');
  const [loading, setLoading]   = useState(false);
  const [showSQL, setShowSQL]   = useState(false);
  const [hasResult, setHasResult] = useState(false);
  const chatRef = useRef(null);

  const exSql = `-- AIè‡ªå‹•ç”Ÿæˆã‚¯ã‚¨ãƒªï¼ˆç·¨é›†å¯èƒ½ï¼‰
SELECT
    age_group,
    COUNT(*) AS patient_count,
    ROUND(COUNT(*) * 100.0 / SUM(COUNT(*)) OVER(), 1) AS percentage
FROM ndb.claims_data
WHERE
    diagnosis_code LIKE 'E11%'   -- 2å‹ç³–å°¿ç—…
    AND claim_year = 2022
GROUP BY age_group
ORDER BY age_group`;

  const chartData = [
    { l:'20ä»£', v:234 }, { l:'30ä»£', v:612 }, { l:'40ä»£', v:1843 },
    { l:'50ä»£', v:3291 }, { l:'60ä»£', v:5124 }, { l:'70ä»£', v:6892 }, { l:'80æ­³+', v:4234 },
  ];
  const sumStats = [['ç·æ‚£è€…æ•°','22,230å'],['ä¸­å¤®å€¤å¹´é½¢','68æ­³'],['60æ­³ä»¥ä¸Šå‰²åˆ','73.2%'],['å‰å¹´æ¯”','+4.8%']];
  const examples = ['2022å¹´ã®ç³–å°¿ç—…æ‚£è€…ã®å¹´é½¢åˆ¥åˆ†å¸ƒã‚’æ•™ãˆã¦','é«˜è¡€åœ§ã¨ç³–å°¿ç—…ã®åˆä½µç‡ã®æ¨ç§»ã¯ï¼Ÿ','éƒ½é“åºœçœŒåˆ¥ãƒ¡ã‚¿ãƒœæœ‰ç—…ç‡ã‚’æ¯”è¼ƒã—ã¦','60æ­³ä»¥ä¸Šã®è…è‡“ç—…æ‚£è€…ã®æŠ•è–¬å‚¾å‘ã¯ï¼Ÿ'];

  const send = () => {
    if (!input.trim() || loading) return;
    const q = input; setInput('');
    setMsgs(p => [...p, { role:'user', text:q }]);
    setLoading(true);
    setTimeout(() => {
      setLoading(false); setHasResult(true);
      setMsgs(p => [...p, { role:'ai', text:'2022å¹´ã®2å‹ç³–å°¿ç—…ï¼ˆICD-10: E11ï¼‰æ‚£è€…ã®å¹´é½¢åˆ¥åˆ†å¸ƒã‚’åˆ†æã—ã¾ã—ãŸã€‚\n\n**ä¸»ãªçŸ¥è¦‹ï¼š**\nâ€¢ ç·æ‚£è€…æ•°ï¼š**22,230å**\nâ€¢ æœ€å¤šå¹´é½¢å±¤ï¼š70ä»£ï¼ˆå…¨ä½“ã®31%ï¼‰\nâ€¢ 60æ­³ä»¥ä¸ŠãŒå…¨ä½“ã® **73%** ã‚’å ã‚ã¦ã„ã¾ã™\nâ€¢ è‹¥å¹´å±¤ï¼ˆ20ã€œ40ä»£ï¼‰ã‚‚å¢—åŠ å‚¾å‘ã«ã‚ã‚Šã¾ã™\n\nã‚°ãƒ©ãƒ•ã¨è©³ç´°çµ±è¨ˆã‚’å³ãƒšã‚¤ãƒ³ã«è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚', hasSQL:true }]);
    }, 1800);
  };

  useEffect(() => { if(chatRef.current) chatRef.current.scrollTop = chatRef.current.scrollHeight; }, [msgs, loading]);

  const renderText = t => t.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');

  return (
    <div className="slide-up" style={{ display:'grid', gridTemplateColumns:'1fr 440px', gap:20, minHeight:660 }}>
      <Card style={{ display:'flex', flexDirection:'column', padding:0, overflow:'hidden' }}>
        <div style={{ background:'linear-gradient(135deg,rgba(22,46,90,0.92),rgba(40,68,116,0.86))', padding:'14px 20px', color:'white', display:'flex', alignItems:'center', gap:12, borderBottom:'1px solid rgba(255,255,255,0.10)' }}>
          <div style={{ width:38, height:38, borderRadius:'50%', background:'linear-gradient(135deg,rgba(249,115,22,0.90),rgba(234,108,16,0.80))', display:'flex', alignItems:'center', justifyContent:'center', fontSize:20, flexShrink:0, boxShadow:'0 2px 10px rgba(249,115,22,0.40)' }}>ğŸ¤–</div>
          <div>
            <div style={{ fontWeight:700, fontSize:15, letterSpacing:'-0.01em' }}>Genie â€” AIãƒ‡ãƒ¼ã‚¿åˆ†æã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ</div>
            <div style={{ fontSize:11, color:'rgba(147,197,253,0.80)', display:'flex', alignItems:'center', gap:6, marginTop:2 }}>
              <span className="pulse" style={{ width:6, height:6, background:'#4ADE80', borderRadius:'50%', display:'inline-block', boxShadow:'0 0 6px rgba(74,222,128,0.60)' }}/>
              Databricks Genie Ã— Claude 3.5 æ­è¼‰ Â· NDBæ¥ç¶šä¸­
            </div>
          </div>
        </div>
        <div ref={chatRef} style={{ flex:1, overflowY:'auto', padding:'20px', display:'flex', flexDirection:'column', gap:16 }}>
          {msgs.map((m,i) => (
            <div key={i}>
              {m.role==='system' && (
                <div style={{ background:'rgba(26,54,93,0.05)', borderRadius:12, padding:'13px 16px', fontSize:13, color:C.textMid, borderLeft:`3px solid rgba(55,105,175,0.50)`, lineHeight:1.75, whiteSpace:'pre-line' }}>
                  {m.text}
                  <div style={{ marginTop:12, display:'flex', flexWrap:'wrap', gap:6 }}>
                    {examples.map((ex,ei) => (
                      <button key={ei} onClick={() => setInput(ex)}
                        style={{ padding:'5px 11px', background:'rgba(255,255,255,0.72)', border:`1px solid rgba(26,54,93,0.16)`, borderRadius:999, fontSize:11, color:C.primaryLight, cursor:'pointer', backdropFilter:'blur(8px)', fontWeight:500, transition:'all 0.15s', fontFamily:'inherit' }}
                        onMouseEnter={e => { e.currentTarget.style.background='rgba(26,54,93,0.08)'; e.currentTarget.style.borderColor='rgba(26,54,93,0.30)'; }}
                        onMouseLeave={e => { e.currentTarget.style.background='rgba(255,255,255,0.72)'; e.currentTarget.style.borderColor='rgba(26,54,93,0.16)'; }}>
                        ğŸ’¡ {ex}
                      </button>
                    ))}
                  </div>
                </div>
              )}
              {m.role==='user' && (
                <div style={{ display:'flex', justifyContent:'flex-end' }}>
                  <div style={{ background:'linear-gradient(135deg,#1A365D,#2D4A7A)', color:'rgba(255,255,255,0.96)', borderRadius:'18px 18px 5px 18px', padding:'10px 16px', maxWidth:'72%', fontSize:13, lineHeight:1.6, boxShadow:'0 2px 12px rgba(26,54,93,0.25)' }}>{m.text}</div>
                </div>
              )}
              {m.role==='ai' && (
                <div className="slide-up" style={{ display:'flex', gap:10, alignItems:'flex-start' }}>
                  <div style={{ width:32, height:32, borderRadius:'50%', background:'rgba(55,105,175,0.12)', border:`1px solid rgba(55,105,175,0.20)`, display:'flex', alignItems:'center', justifyContent:'center', fontSize:16, flexShrink:0 }}>ğŸ¤–</div>
                  <div style={{ flex:1 }}>
                    <div style={{ background:'rgba(255,255,255,0.78)', border:`1px solid rgba(255,255,255,0.90)`, borderRadius:'18px 18px 18px 5px', padding:'11px 16px', fontSize:13, lineHeight:1.75, boxShadow:'0 2px 12px rgba(26,54,93,0.07)', backdropFilter:'blur(12px)', color:C.text }}
                      dangerouslySetInnerHTML={{ __html:renderText(m.text) }}/>
                    {m.hasSQL && (
                      <div style={{ marginTop:8 }}>
                        <button onClick={() => setShowSQL(s=>!s)}
                          style={{ display:'flex', alignItems:'center', gap:6, padding:'6px 12px', background:'rgba(15,23,42,0.88)', color:'rgba(148,163,184,0.90)', border:'1px solid rgba(255,255,255,0.08)', borderRadius:7, fontSize:11, cursor:'pointer', fontFamily:'monospace', backdropFilter:'blur(8px)', letterSpacing:'0.02em' }}>
                          <span>{showSQL?'â–¼':'â–¶'}</span> è‡ªå‹•ç”ŸæˆSQL
                          <span style={{ marginLeft:6, background:'rgba(255,255,255,0.08)', padding:'1px 6px', borderRadius:4, fontSize:10 }}>ã‚¯ãƒªãƒƒã‚¯ã§{showSQL?'æŠ˜ã‚ŠãŸãŸã‚€':'å±•é–‹'}</span>
                        </button>
                        {showSQL && (
                          <div className="slide-up" style={{ background:'rgba(15,23,42,0.94)', color:'rgba(226,232,240,0.92)', borderRadius:10, padding:'13px 16px', fontFamily:'monospace', fontSize:11, lineHeight:1.75, marginTop:5, overflowX:'auto', border:'1px solid rgba(255,255,255,0.07)', backdropFilter:'blur(16px)' }}>
                            <pre style={{ margin:0 }}>{exSql}</pre>
                          </div>
                        )}
                      </div>
                    )}
                  </div>
                </div>
              )}
            </div>
          ))}
          {loading && (
            <div style={{ display:'flex', gap:10, alignItems:'flex-start' }}>
              <div style={{ width:32, height:32, borderRadius:'50%', background:'rgba(55,105,175,0.12)', display:'flex', alignItems:'center', justifyContent:'center', fontSize:16 }}>ğŸ¤–</div>
              <div style={{ background:'rgba(255,255,255,0.78)', border:`1px solid rgba(255,255,255,0.90)`, borderRadius:'18px 18px 18px 5px', padding:'14px 18px', display:'flex', gap:6, backdropFilter:'blur(12px)' }}>
                {[0.0,0.25,0.5].map((d,i) => <div key={i} className="pulse" style={{ width:8, height:8, borderRadius:'50%', background:'rgba(55,105,175,0.45)', animationDelay:`${d}s` }}/>)}
              </div>
            </div>
          )}
        </div>
        <div style={{ padding:14, borderTop:`1px solid rgba(26,54,93,0.10)`, background:'rgba(248,250,252,0.60)', backdropFilter:'blur(12px)' }}>
          <div style={{ display:'flex', gap:10, alignItems:'flex-end' }}>
            <textarea value={input} onChange={e => setInput(e.target.value)}
              onKeyDown={e => { if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();send();} }}
              placeholder="ä¾‹ï¼š2022å¹´ã®ç³–å°¿ç—…æ‚£è€…ã®å¹´é½¢åˆ¥åˆ†å¸ƒã‚’æ•™ãˆã¦ï¼ˆShift+Enterã§æ”¹è¡Œï¼‰"
              rows={2}
              className="input-glass"
              style={{ flex:1, padding:'9px 13px', fontSize:13, resize:'none', lineHeight:1.55 }}/>
            <button onClick={send} disabled={loading||!input.trim()} className="btn-primary"
              style={{ padding:'11px 18px', fontSize:13, opacity:input.trim()?1:0.45, cursor:input.trim()?'pointer':'default', whiteSpace:'nowrap', borderRadius:11 }}>
              é€ä¿¡ â†’
            </button>
          </div>
        </div>
      </Card>

      <div style={{ display:'flex', flexDirection:'column', gap:14 }}>
        {hasResult ? (
          <>
            <Card style={{ padding:18 }}>
              <div style={{ display:'flex', justifyContent:'space-between', alignItems:'flex-start', marginBottom:14 }}>
                <div>
                  <h3 style={{ fontSize:13, fontWeight:700, color:C.text, letterSpacing:'-0.01em' }}>2022å¹´ 2å‹ç³–å°¿ç—… å¹´é½¢åˆ¥æ‚£è€…æ•°</h3>
                  <p style={{ fontSize:10.5, color:C.textLight, marginTop:2 }}>ãƒ‡ãƒ¼ã‚¿: NDBï¼ˆãƒ¬ã‚»ãƒ—ãƒˆï¼‰| å¯¾è±¡: å…¨å›½</p>
                </div>
                <div style={{ display:'flex', gap:6 }}>
                  {['ğŸ“¥ CSV','ğŸ–¼ï¸ PNG'].map(l => (
                    <button key={l} className="btn-outline" style={{ padding:'4px 10px', fontSize:11 }}>{l}</button>
                  ))}
                </div>
              </div>
              <BarChart data={chartData} colorA="#F97316" colorB="#FBBF24" height={110}/>
            </Card>
            <Card style={{ padding:18 }}>
              <h3 style={{ fontSize:12, fontWeight:700, color:C.text, marginBottom:12, letterSpacing:'-0.01em' }}>ğŸ“Š çµ±è¨ˆã‚µãƒãƒªãƒ¼</h3>
              <div style={{ display:'grid', gridTemplateColumns:'1fr 1fr', gap:8 }}>
                {sumStats.map(([label,val]) => (
                  <div key={label} style={{ background:'rgba(26,54,93,0.04)', borderRadius:9, padding:'10px 13px', border:`1px solid rgba(26,54,93,0.08)` }}>
                    <div style={{ fontSize:10, color:C.textLight, marginBottom:3, letterSpacing:'0.03em' }}>{label}</div>
                    <div style={{ fontSize:18, fontWeight:700, color:C.text, letterSpacing:'-0.02em' }}>{val}</div>
                  </div>
                ))}
              </div>
            </Card>
            <div style={{ display:'flex', flexDirection:'column', gap:8 }}>
              <button style={{ padding:'12px 16px', background:'linear-gradient(135deg,#1A365D,#2D4A7A)', color:'white', border:'none', borderRadius:11, fontSize:13, fontWeight:700, cursor:'pointer', display:'flex', alignItems:'center', justifyContent:'center', gap:8, fontFamily:'inherit', boxShadow:'0 3px 14px rgba(26,54,93,0.28), inset 0 1px 0 rgba(255,255,255,0.08)' }}>ğŸ“Œ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«è¿½åŠ </button>
              <button className="btn-outline" style={{ padding:'12px 16px', fontSize:13, display:'flex', alignItems:'center', justifyContent:'center', gap:8 }}>ğŸ“¤ æŒå‡ºç”³è«‹ï¼ˆãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼‰</button>
              <button style={{ padding:'12px 16px', background:'rgba(249,115,22,0.07)', color:'#9A3412', border:'1px solid rgba(249,115,22,0.22)', borderRadius:11, fontSize:13, fontWeight:700, cursor:'pointer', display:'flex', alignItems:'center', justifyContent:'center', gap:8, fontFamily:'inherit', backdropFilter:'blur(8px)' }}>ğŸ”— ã‚³ãƒ›ãƒ¼ãƒˆå‚ç…§ç”»é¢ã§è©³ç´°ç¢ºèª</button>
            </div>
          </>
        ) : (
          <div className="glass" style={{ display:'flex', flexDirection:'column', alignItems:'center', justifyContent:'center', gap:14, flex:1, padding:40, border:`1px dashed rgba(26,54,93,0.18)` }}>
            <div style={{ fontSize:52, opacity:0.18 }}>ğŸ“Š</div>
            <div style={{ fontSize:13, color:C.textLight, textAlign:'center', lineHeight:1.85 }}>å·¦ã®ãƒãƒ£ãƒƒãƒˆã§è³ªå•ã™ã‚‹ã¨<br/>ã‚°ãƒ©ãƒ•ã‚„çµ±è¨ˆæƒ…å ±ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</div>
            <div style={{ display:'flex', flexDirection:'column', gap:7, width:'100%', maxWidth:240 }}>
              {['SQLè‡ªå‹•ç”Ÿæˆï¼ˆæŠ˜ã‚ŠãŸãŸã¿è¡¨ç¤ºï¼‰','ã‚°ãƒ©ãƒ•è‡ªå‹•æç”»','ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰é€£æº','æŒå‡ºç”³è«‹ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯'].map(f => (
                <div key={f} style={{ display:'flex', alignItems:'center', gap:8, fontSize:12, color:C.textMid }}>
                  <span style={{ color:C.accent, fontWeight:700, fontSize:13 }}>âœ“</span> {f}
                </div>
              ))}
            </div>
          </div>
        )}
      </div>
    </div>
  );
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ãƒ˜ãƒƒãƒ€ãƒ¼
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function Header() {
  return (
    <header className="glass-dark" style={{ padding:'0 24px', height:56, display:'flex', alignItems:'center', justifyContent:'space-between' }}>
      <div style={{ display:'flex', alignItems:'center', gap:18 }}>
        <div style={{ display:'flex', alignItems:'center', gap:11 }}>
          <div style={{ width:32, height:32, background:'linear-gradient(135deg,#F97316,#FBBF24)', borderRadius:9, display:'flex', alignItems:'center', justifyContent:'center', fontSize:17, boxShadow:'0 2px 10px rgba(249,115,22,0.45)' }}>âš•</div>
          <div>
            <div style={{ color:'rgba(255,255,255,0.96)', fontWeight:700, fontSize:14.5, lineHeight:1, letterSpacing:'-0.02em' }}>åŒ»ç™‚ç­‰æƒ…å ±æ´»ç”¨åŸºç›¤ãƒãƒ¼ã‚¿ãƒ«</div>
          </div>
        </div>
        <div style={{ height:26, width:1, background:'rgba(255,255,255,0.08)' }}/>
        <div style={{ display:'flex', gap:5 }}>
          {['NDB','DPC','ãƒ¬ã‚»ãƒ—ãƒˆ','é›»å­ã‚«ãƒ«ãƒ†(è©¦)'].map(db => (
            <span key={db} style={{ padding:'2px 8px', background:'rgba(55,105,175,0.20)', border:'1px solid rgba(55,105,175,0.30)', borderRadius:5, fontSize:9.5, color:'rgba(147,197,253,0.90)', fontWeight:600, letterSpacing:'0.04em' }}>{db}</span>
          ))}
        </div>
      </div>
      <div style={{ display:'flex', alignItems:'center', gap:16 }}>
        <div style={{ display:'flex', alignItems:'center', gap:6, fontSize:11.5, color:'rgba(100,116,139,0.80)' }}>
          <span className="pulse" style={{ width:6, height:6, background:'#4ADE80', borderRadius:'50%', display:'inline-block', boxShadow:'0 0 6px rgba(74,222,128,0.55)' }}/>
          ã‚·ã‚¹ãƒ†ãƒ æ­£å¸¸ç¨¼åƒä¸­
        </div>
        <div style={{ display:'flex', alignItems:'center', gap:8, background:'rgba(255,255,255,0.07)', border:'1px solid rgba(255,255,255,0.10)', borderRadius:999, padding:'4px 14px 4px 4px', cursor:'pointer', backdropFilter:'blur(12px)' }}>
          <div style={{ width:28, height:28, borderRadius:'50%', background:'linear-gradient(135deg,#F97316,#FBBF24)', display:'flex', alignItems:'center', justifyContent:'center', fontSize:14, boxShadow:'0 2px 8px rgba(249,115,22,0.35)' }}>ğŸ‘¤</div>
          <div>
            <div style={{ color:'rgba(255,255,255,0.92)', fontSize:12, fontWeight:600, letterSpacing:'-0.01em' }}>å¤ªéƒ</div>
            <div style={{ color:'rgba(148,163,184,0.65)', fontSize:9.5 }}>åˆ†ææ‹…å½“</div>
          </div>
        </div>
      </div>
    </header>
  );
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function TabNav({ active, setActive }) {
  const tabs = [
    { id:'home',   label:'ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ›ãƒ¼ãƒ ',            icon:'ğŸ ' },
    { id:'search', label:'é¡ä¼¼ç ”ç©¶æ¤œç´¢',                  icon:'ğŸ“š', badge:'NEW' },
    { id:'cohort', label:'ã‚³ãƒ›ãƒ¼ãƒˆå‚ç…§ï¼ˆãƒ•ã‚£ãƒ¼ã‚¸ãƒ“ãƒªãƒ†ã‚£èª¿æŸ»ï¼‰', icon:'ğŸ”', badge:'MAIN' },
    { id:'ai',     label:'AIåˆ†æã‚¢ã‚·ã‚¹ãƒˆï¼ˆGenieï¼‰',       icon:'ğŸ¤–' },
  ];
  return (
    <div className="glass-blue" style={{ padding:'0 24px', display:'flex' }}>
      {tabs.map(t => (
        <button key={t.id} onClick={() => setActive(t.id)}
          style={{ padding:'13px 20px', background:'transparent', border:'none', borderBottom:active===t.id?`2.5px solid #F97316`:'2.5px solid transparent', color:active===t.id?'rgba(255,255,255,0.96)':'rgba(148,163,184,0.65)', cursor:'pointer', fontSize:13, fontWeight:active===t.id?700:400, display:'flex', alignItems:'center', gap:6, whiteSpace:'nowrap', transition:'all 0.16s', letterSpacing:active===t.id?'-0.01em':'0', fontFamily:'inherit' }}>
          {t.icon} {t.label}
          {t.badge && <span style={{ background:'linear-gradient(135deg,#F97316,#FBBF24)', color:'white', fontSize:9, padding:'1px 6px', borderRadius:999, fontWeight:700, letterSpacing:'0.04em', boxShadow:'0 1px 6px rgba(249,115,22,0.40)' }}>{t.badge}</span>}
        </button>
      ))}
    </div>
  );
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   App ãƒ«ãƒ¼ãƒˆ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function App() {
  const [tab, setTab] = useState('home');
  return (
    <div style={{ minHeight:'100vh' }}>
      <Header/>
      <TabNav active={tab} setActive={setTab}/>
      <main style={{ padding:'22px 24px', maxWidth:1440, margin:'0 auto' }}>
        {tab==='home'   && <HomeScreen setTab={setTab}/>}
        {tab==='search' && <ResearchSearchScreen setTab={setTab}/>}
        {tab==='cohort' && <CohortScreen/>}
        {tab==='ai'     && <AIScreen/>}
      </main>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>
